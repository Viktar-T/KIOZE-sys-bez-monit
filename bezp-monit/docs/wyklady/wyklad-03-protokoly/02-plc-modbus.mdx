---
title: "PLC i protokoÅ‚y Modbus RTU/TCP"
sidebar_position: 2
---

import { 
  SlideContainer, 
  Slide, 
  KeyPoints, 
  SupportingDetails, 
  InstructorNotes,
  VisualSeparator,
  LearningObjective,
  KeyConcept,
  Example
} from '@site/src/components/SlideComponents';

<LearningObjective>
Po tej sekcji student potrafi:
- ZdefiniowaÄ‡ rolÄ™ PLC w systemach monitoringu OZE i zrozumieÄ‡ ich podstawowÄ… architekturÄ™
- WyjaÅ›niÄ‡ rÃ³Å¼nice miÄ™dzy protokoÅ‚ami Modbus RTU i Modbus TCP, oraz zastosowaÄ‡ odpowiedni w rÃ³Å¼nych scenariuszach
- ZidentyfikowaÄ‡ i skonfigurowaÄ‡ rejestry Modbus (Holding, Input, Coil, Discrete) w kontekÅ›cie czujnikÃ³w OZE
- ZaprojektowaÄ‡ mapowanie danych z urzÄ…dzeÅ„ (inwertery, czujniki pogodowe) do odpowiednich rejestrÃ³w Modbus
</LearningObjective>

<SlideContainer>

<Slide title="ğŸ¤– Wprowadzenie do PLC w systemach OZE" type="info">

<KeyPoints title="ğŸ“‹ Co to jest PLC?">
- **PLC** = Programmable Logic Controller (Sterownik Programowalny)
- **Specjalizowany komputer przemysÅ‚owy** zaprojektowany do automatyki
- **Operuje w czasie rzeczywistym** z deterministycznymi czasami odpowiedzi
- **Odporny na warunki przemysÅ‚owe** (temperatura, wilgotnoÅ›Ä‡, wibracje, EMI)
- **Komunikuje siÄ™** z rÃ³Å¼nymi protokoÅ‚ami (Modbus, Ethernet, OPC UA)
</KeyPoints>

<SupportingDetails title="ğŸ¯ Rola PLC w instalacjach OZE">

**PLC w systemach OZE peÅ‚niÄ… kluczowe funkcje:**

**1. Zbieranie danych z czujnikÃ³w**
- Pomiary napiÄ™Ä‡, prÄ…dÃ³w, temperatur, ciÅ›nieÅ„
- Dane pogodowe (nasÅ‚onecznienie, prÄ™dkoÅ›Ä‡ wiatru, temperatura otoczenia)
- Status urzÄ…dzeÅ„ (inwertery, kontakty, wyÅ‚Ä…czniki)

**2. Realizacja algorytmÃ³w sterowania**
- Sterowanie pracÄ… inwerterÃ³w
- ZarzÄ…dzanie magazynami energii (BESS)
- Automatyczne wyÅ‚Ä…czanie przy awariach

**3. Komunikacja z systemami nadrzÄ™dnymi**
- SCADA, MES (Manufacturing Execution System)
- Chmury obliczeniowe, platformy IoT

</SupportingDetails>

**Typowa architektura PLC w farmie PV:**

```mermaid
graph TB
    subgraph "PLC - ModuÅ‚y wejÅ›Ä‡/wyjÅ›Ä‡"
        CPU[CPU ModuÅ‚<br/>Program sterowania]
        AI[Analog Input<br/>4-20mA, 0-10V]
        DI[Digital Input<br/>24V DC]
        AO[Analog Output<br/>4-20mA]
        DO[Digital Output<br/>24V DC Relays]
        COM[Communication<br/>Modbus RTU/TCP]
        
        CPU --- AI
        CPU --- DI
        CPU --- AO
        CPU --- DO
        CPU --- COM
    end
    
    subgraph "Czujniki i urzÄ…dzenia"
        CT[PrzekÅ‚adniki prÄ…dowe<br/>4-20mA]
        VT[PrzekÅ‚adniki napiÄ™ciowe<br/>0-10V]
        WS[Stacja pogodowa<br/>Modbus RTU]
        INV[Inwerter<br/>Modbus TCP]
        CONT[Kontaktory wyÅ‚Ä…cznikÃ³w<br/>24V DC]
    end
    
    subgraph "Komunikacja z SCADA"
        SCADA[SCADA Server]
        HMI[HMI Workstation]
        
        SCADA --- COM
        SCADA --- HMI
    end
    
    CT --- AI
    VT --- AI
    WS --- COM
    INV --- COM
    CONT --- DO
    
    style CPU fill:#ffd700
    style COM fill:#87ceeb
    style SCADA fill:#90ee90
```

<InstructorNotes>

**Zacznij od podstaw**: PLC to "maÅ‚y komputer przemysÅ‚owy". **Nie Windows, nie Linux** - specjalny system operacyjny (czÄ™sto real-time OS) zaprojektowany do automatyki.

**Kluczowa rÃ³Å¼nica od PC**: **deterministyczne** czasy odpowiedzi. W PC gdy system siÄ™ zawiesi, aplikacja moÅ¼e czekaÄ‡. **W PLC to niedopuszczalne** - zawsze musi odpowiedzieÄ‡ w okreÅ›lonym czasie (ms).

PokaÅ¼ diagram architektury. **CPU** wykonuje program, **moduÅ‚y I/O** Å‚Ä…czÄ… siÄ™ ze Å›wiatem zewnÄ™trznym. **Communication moduÅ‚** (COM) to interfejs do sieci.

**PrzykÅ‚ady z OZE**: PLC w farmie PV odczytuje dane z 20 inwerterÃ³w przez Modbus TCP, z 5 stacji pogodowych przez Modbus RTU, z czujnikÃ³w analogowych (prÄ…d/napiÄ™cie), kontroluje wyÅ‚Ä…czniki kontaktowe.

**Czas**: 5-6 minut z diagramem.

</InstructorNotes>

</Slide>

<VisualSeparator type="default" />

<Slide title="ğŸ“¡ ProtokÃ³Å‚ Modbus - podstawy" type="info">

<KeyPoints title="ğŸ“‹ Historia i standardy Modbus">
- **Modbus** opracowany przez Modicon (1979) - pierwszy standard komunikacji przemysÅ‚owej
- **Open standard** - moÅ¼e implementowaÄ‡ kaÅ¼dy producent
- **Dwie gÅ‚Ã³wne wersje**: Modbus RTU (serial) i Modbus TCP (Ethernet)
- **Prosty i niezawodny** - szeroko stosowany w automatyce przemysÅ‚owej
- **ObsÅ‚uga**: wszystkie urzÄ…dzenia OZE (inwertery, czujniki, BMS, stacje pogodowe)
</KeyPoints>

**Modele komunikacji Modbus:**

```mermaid
graph LR
    subgraph "Master-Slave Model"
        M[Master<br/>SCADA/PLC]
        S1[Slave 1<br/>Inwerter]
        S2[Slave 2<br/>Czujnik pogody]
        S3[Slave 3<br/>BMS]
        
        M -->|Request| S1
        M -->|Request| S2  
        M -->|Request| S3
        
        S1 -->|Response| M
        S2 -->|Response| M
        S3 -->|Response| M
    end
    
    style M fill:#ffd700
    style S1 fill:#87ceeb
    style S2 fill:#87ceeb
    style S3 fill:#87ceeb
```

<SupportingDetails title="ğŸ”„ Cykl komunikacji Master-Slave">

**1. Master wysyÅ‚a request** (funkcja + adres slave + dane)
**2. Slave przetwarza request** (odczyt/zapis rejestrÃ³w)  
**3. Slave odpowiada** (potwierdzenie + dane/status)
**4. Master interpretuje response** (success/error handling)

**Typowe funkcje:**
- **03**: Read Holding Registers (16-bit)
- **04**: Read Input Registers (16-bit)
- **01**: Read Coils (1-bit digital out)
- **02**: Read Discrete Inputs (1-bit digital in)
- **06**: Write Single Register (16-bit)
- **16**: Write Multiple Registers (16-bit)

</SupportingDetails>

<KeyConcept title="âš ï¸ Limitation: Master-Slave tylko">
Modbus **nie obsÅ‚uguje peer-to-peer** komunikacji. Tylko Master moÅ¼e inicjowaÄ‡ komunikacjÄ™. To moÅ¼e byÄ‡ ograniczeniem w nowoczesnych systemach IoT, gdzie potrzebna jest komunikacja miÄ™dzy urzÄ…dzeniami.
</KeyConcept>

<InstructorNotes>

**Modbus to fundament** komunikacji przemysÅ‚owej - **40+ lat historii**, nadal powszechnie stosowany.

**Master-Slave model** - kluczowe do zrozumienia. **Tylko Master inicjuje komunikacjÄ™**. Slave czeka na request i odpowiada. JeÅ›li Slave ma coÅ› waÅ¼nego do powiedzenia, musi czekaÄ‡ na Master.

**Funkcje** - pokaÅ¼ listÄ™ najwaÅ¼niejszych. **03 i 04** to workhorse - wiÄ™kszoÅ›Ä‡ danych z czujnikÃ³w jest w rejestrach 16-bit (Holdings dla danych konfiguracyjnych, Inputs dla danych pomiarowych).

**Limitation** - warto wspomnieÄ‡, Å¼e to moÅ¼e byÄ‡ problem w systemach IoT, gdzie potrzebna komunikacja miÄ™dzy urzÄ…dzeniami. Ale dla tradycyjnej automatyki sprawdza siÄ™ doskonale.

**Czas**: 4-5 minut z diagramem komunikacji.

</InstructorNotes>

</Slide>

<VisualSeparator type="default" />

<Slide title="ğŸ”Œ Modbus RTU vs Modbus TCP" type="tip">

<KeyPoints title="ğŸ“‹ Modbus RTU (Remote Terminal Unit)">
- **Transmisja szeregowa** przez RS-485 (fizycznie) lub RS-232
- **Jeden kabel** moÅ¼e obsÅ‚ugiwaÄ‡ do 247 urzÄ…dzeÅ„ (slave IDs 1-247)
- **DÅ‚ugie dystanse** - do 1200m z RS-485, z repeaterami nawet dalej
- **Niski koszt** - prosta implementacja sprzÄ™towa
- **Potrzeba terminatorÃ³w** na koÅ„cach linii
</KeyPoints>

<KeyPoints title="ğŸ“‹ Modbus TCP/IP">
- **Transmisja przez Ethernet** - standard TCP/IP
- **Jedno urzÄ…dzenie na adres IP** (ale moÅ¼e mieÄ‡ rÃ³Å¼ne unit IDs)
- **Wysoka prÄ™dkoÅ›Ä‡** - 100 Mbps vs 115 kbps (RTU)
- **Routing przez sieÄ‡** - moÅ¼na komunikowaÄ‡ siÄ™ przez internet
- **WyÅ¼szy koszt** - wymaga stack TCP/IP
</KeyPoints>

### PorÃ³wnanie techniczne

| Cecha | Modbus RTU | Modbus TCP |
|-------|------------|-------------|
| **Medium fizyczne** | RS-485/232 | Ethernet |
| **PrÄ™dkoÅ›Ä‡** | 115 kbps | 100+ Mbps |
| **Dystans** | 1200m | 100m (cat5e) |
| **Topologia** | Master-slave bus | IP network |
| **Koszt** | â‚¬â‚¬ | â‚¬â‚¬â‚¬ |
| **Setup** | Terminatorzy + adresy | IP addressing |
| **Routing** | Nie | Tak |
| **Zastosowanie** | Local fieldbus | Network/distributed |

**Typowe zastosowania w OZE:**

```mermaid
graph TB
    subgraph "Modbus RTU - Local Fieldbus"
        PLC[PLC Master]
        INV1[Inwerter 1<br/>ID=1]
        INV2[Inwerter 2<br/>ID=2]
        INV3[Inwerter 3<br/>ID=3]
        WS[Stacja pogodowa<br/>ID=10]
        
        PLC ---|RS-485| INV1
        PLC ---|RS-485| INV2
        PLC ---|RS-485| INV3
        PLC ---|RS-485| WS
    end
    
    subgraph "Modbus TCP - Network"
        SCADA[SCADA Server]
        PLC1[PLC Station 1<br/>192.168.1.10]
        PLC2[PLC Station 2<br/>192.168.1.11]
        HUB[Network Hub]
        
        SCADA ---|Ethernet| HUB
        PLC1 ---|Ethernet| HUB
        PLC2 ---|Ethernet| HUB
    end
    
    style PLC fill:#ffd700
    style SCADA fill:#90ee90
```

<InstructorNotes>

**Kluczowa decyzja projektowa**: RTU czy TCP? To zaleÅ¼y od **architektury sieci** i **dystansÃ³w**.

**Modbus RTU** - **dla lokalnych instalacji** gdzie wszystkie urzÄ…dzenia sÄ… blisko siebie (do 1-2km) i potrzebujemy **prostej, niezawodnej komunikacji**. Jeden kabel RS-485 obsÅ‚uguje dziesiÄ…tki urzÄ…dzeÅ„.

**Modbus TCP** - **dla rozproszonych instalacji** gdzie urzÄ…dzenia sÄ… w rÃ³Å¼nych lokalizacjach (rÃ³Å¼ne budynki, nawet rÃ³Å¼ne miasta). **Routing przez sieÄ‡ IP** umoÅ¼liwia komunikacjÄ™ przez internet.

**PokaÅ¼ przykÅ‚ady**:
- **RTU**: farma PV - wszystkie inwertery w jednym budynku, jedna linia RS-485
- **TCP**: farma PV w 3 lokalizacjach - kaÅ¼da ma PLC z IP, komunikacja przez VPN

**W praktyce czÄ™sto Å‚Ä…czy siÄ™**: RTU lokalnie, TCP do komunikacji z SCADA.

**Czas**: 6-7 minut z przykÅ‚adami praktycznymi.

</InstructorNotes>

</Slide>

<VisualSeparator type="default" />

<Slide title="ğŸ“Š Rejestry Modbus - mapowanie danych" type="technical">

<KeyPoints title="ğŸ“‹ Typy rejestrÃ³w w Modbus">
- **Holding Registers** (4xxxxx) - R/W, konfiguracja urzÄ…dzeÅ„
- **Input Registers** (3xxxxx) - R-only, dane pomiarowe (czujniki)
- **Coils** (0xxxxx) - R/W, wyjÅ›cia dyskretne (1-bit)
- **Discrete Inputs** (1xxxxx) - R-only, wejÅ›cia dyskretne (1-bit)

**Konwencja adresacji**: 40001 = Holding Register #1, 30001 = Input Register #1
</KeyPoints>

**PrzykÅ‚ad mapowania dla inwertera PV:**

```mermaid
graph TB
    subgraph "Inwerter 50kW - Modbus Map"
        subgraph "Holding Registers (4xxxx)"
            H1[40001: Max Power<br/>Writable]
            H2[40002: Grid Voltage<br/>Setpoint]
            H3[40003: Frequency<br/>Setpoint]
        end
        
        subgraph "Input Registers (3xxxx)"
            I1[30001: AC Power<br/>Actual W]
            I2[30002: AC Voltage<br/>Actual V]
            I3[30003: AC Current<br/>Actual A]
            I4[30004: DC Voltage<br/>Actual V]
            I5[30005: DC Current<br/>Actual A]
            I6[30006: Temperature<br/>Â°C]
            I7[30007: Efficiency<br/>%]
            I8[30008: Daily Energy<br/>kWh]
        end
        
        subgraph "Coils (0xxxx)"
            C1[00001: Start/Stop]
            C2[00002: Reset Alarms]
        end
        
        subgraph "Discrete Inputs (1xxxx)"
            D1[10001: Running Status]
            D2[10002: Fault Status]
            D3[10003: Grid Connected]
        end
    end
```

<Example title="Mapowanie dla stacji pogodowej">

**Stacja pogodowa - przykÅ‚adowe mapowanie:**

| Adres | Nazwa | Typ | Jednostka | Opis |
|-------|-------|-----|-----------|------|
| 30001 | Irradiance | Input | W/mÂ² | Napromieniowanie globalne |
| 30002 | Temp_Ambient | Input | Â°C | Temperatura otoczenia |
| 30003 | Wind_Speed | Input | m/s | PrÄ™dkoÅ›Ä‡ wiatru |
| 30004 | Wind_Direction | Input | Â° | Kierunek wiatru |
| 30005 | Humidity | Input | % | WilgotnoÅ›Ä‡ wzglÄ™dna |
| 10001 | Rain_Sensor | Discrete | bool | Sensor deszczu |
| 10002 | Anemometer_OK | Discrete | bool | Status anemometru |

**Odczyt danych przez Modbus:**
```
Master Request: Read Input Registers (function 04)
- Start Address: 30001
- Quantity: 5 registers
Slave Response: [850, 23, 3.2, 45, 65] (irrad [W/mÂ²], temp [Â°C], ...)
```

</Example>

<SupportingDetails title="âš ï¸ NajczÄ™stsze bÅ‚Ä™dy w mapowaniu">

**1. BÅ‚Ä™dne interpretowanie jednostek**
- Register 30001: wartoÅ›Ä‡ 850 = 85.0 W/mÂ² czy 850 W/mÂ²?
- **RozwiÄ…zanie**: zawsze sprawdzaÄ‡ dokumentacjÄ™ producenta

**2. Kierunek bajtÃ³w (Byte Ordering)**
- Big Endian vs Little Endian
- Register value: 0x1234 = 4660 (decimal) czy 13330?

**3. Skalowanie wartoÅ›ci**
- Register: raw value 1234
- Rzeczywista wartoÅ›Ä‡: (1234 - offset) / scale factor

</SupportingDetails>

<InstructorNotes>

**Mapowanie rejestrÃ³w to serce** Modbus - trzeba wiedzieÄ‡, gdzie szukaÄ‡ jakich danych.

**PokaÅ¼ przykÅ‚ad inwertera**. **Holding Registers** - konfiguracja (max power, voltage setpoints). **Input Registers** - pomiary (actual power, temperature). **Coils** - sterowanie (start/stop). **Discrete Inputs** - status (running, fault).

**Praktyczny przykÅ‚ad**: jak odczytaÄ‡ moc AC z inwertera? Function 04 (Read Input Registers), Address 30001, Quantity 1. Response: [15500] oznacza 15.5 kW (jeÅ›li scale = 1.0).

**BÅ‚Ä™dy w mapowaniu** to czÄ™sta przyczyna problemÃ³w. **Jednostki** - czy 850 to 85.0 czy 850 W/mÂ²? **Byte ordering** - 0x1234 moÅ¼e byÄ‡ rÃ³Å¼nie interpretowane. **Skalowanie** - surowa wartoÅ›Ä‡ vs rzeczywista.

**Zawsze sprawdzaÄ‡ dokumentacjÄ™ producenta** - kaÅ¼dy ma inne mapowanie!

**Czas**: 7-8 minut z praktycznymi przykÅ‚adami odczytu.

</InstructorNotes>

</Slide>

<VisualSeparator type="default" />

<Slide title="ğŸ› ï¸ Praktyczna konfiguracja i testowanie" type="success">

<KeyPoints title="ğŸ“‹ Kroki implementacji Modbus">
1. **Okablowanie** - RS-485 z terminatorem 120Î© na koÅ„cach
2. **Konfiguracja adresÃ³w** - unikalne slave ID dla kaÅ¼dego urzÄ…dzenia
3. **Mapowanie rejestrÃ³w** - dokumentacja kaÅ¼dego urzÄ…dzenia
4. **Testowanie komunikacji** - narzÄ™dzia diagnostyczne
5. **Integracja z SCADA** - konfiguracja driverÃ³w Modbus
</KeyPoints>

<Example title="Konfiguracja farmy PV 1MW">

**Parametry systemu:**
- 20 inwerterÃ³w 50kW kaÅ¼dy
- 1 stacja pogodowa
- 1 PLC jako Modbus Master
- Komunikacja RS-485 z hub/switch

**Przypisanie Slave IDs:**
```
Inwertery: 1-20 (ID = numer inwertera)
Stacja pogodowa: 50 (ID = 50 untuk weather station)
PLC Master: No ID needed (to jest master)
```

**Konfiguracja kablowa RS-485:**
```
+ Data A: czerwony przewÃ³d
- Data B: czarny przewÃ³d  
Terminator 120Î© na obu koÅ„cach linii
Maksymalna dÅ‚ugoÅ›Ä‡: 500m (z hub)
```

</Example>

**NarzÄ™dzia testowe i debugowanie:**

<SupportingDetails title="ğŸ”§ Software tools">

**1. Modbus Poll/Master**
- Komercjalne narzÄ™dzie do testowania komunikacji
- ObsÅ‚uga RTU i TCP
- Real-time monitoring, data logging

**2. QModMaster (Open Source)**
- Darmowe narzÄ™dzie do testÃ³w Modbus
- Cross-platform (Windows/Linux)
- Basic functionality, good for learning

**3. Custom scripts (Python)**
```python
from pymodbus.client.sync import ModbusSerialClient

client = ModbusSerialClient(method='rtu', port='COM1', baudrate=9600)
if client.connect():
    result = client.read_input_registers(30001, 1, unit=1)  # Read from inverter ID=1
    print(f"AC Power: {result.registers[0]} W")
```

</SupportingDetails>

**Typowe problemy i rozwiÄ…zania:**

| Problem | Przyczyna | RozwiÄ…zanie |
|---------|-----------|-------------|
| **No response** | BÅ‚Ä™dne ID, brak terminacji | Check slave IDs, 120Î© terminators |
| **Timeouts** | Zbyt dÅ‚ugi polling interval | Reduce scan rate |
| **Bad data** | BÅ‚Ä…d w mapowaniu, endianness | Verify register mapping |
| **CRC errors** | ZÅ‚e ustawienia komunikacji | Check baud rate, parity |

<InstructorNotes>

**To jest praktyczny slajd** - jak rzeczywiÅ›cie implementowaÄ‡ Modbus w terenie.

**Okablowanie RS-485** - **czÄ™sty bÅ‚Ä…d**: zapomnienie o terminatorach. Bez 120Î© rezystorÃ³w na koÅ„cach linii komunikacja nie dziaÅ‚a lub jest niestabilna.

**Slave IDs** - kaÅ¼dy slave musi mieÄ‡ unikalny adres. Typowy bÅ‚Ä…d: dwa urzÄ…dzenia z tym samym ID, co prowadzi do konfliktÃ³w.

**NarzÄ™dzia testowe** - zacznij od **QModMaster** (darmowe), potem moÅ¼na przejÅ›Ä‡ na **Modbus Poll** dla profesjonalnego uÅ¼ycia. **Python scripts** dla automatyzacji.

**Typowe problemy** - tabela z rzeczywistymi bÅ‚Ä™dami. **No response** = najczÄ™Å›ciej brak terminacji lub bÅ‚Ä™dny slave ID. **CRC errors** = problem z ustawieniami komunikacji (baud rate, parity, stop bits).

**PokaÅ¼ przykÅ‚ad** konfiguracji farmy PV - to jest konkretny case study z rzeczywistymi parametrami.

**Czas**: 6-7 minut z praktycznymi przykÅ‚adami.

</InstructorNotes>

</Slide>

</SlideContainer>
