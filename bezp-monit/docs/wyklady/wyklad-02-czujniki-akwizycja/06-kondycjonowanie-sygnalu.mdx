---
title: "Kondycjonowanie sygnaÅ‚Ã³w"
sidebar_position: 6
---

import { 
  SlideContainer, 
  Slide, 
  KeyPoints, 
  SupportingDetails, 
  InstructorNotes,
  VisualSeparator,
  LearningObjective,
  KeyConcept,
  Example
} from '@site/src/components/SlideComponents';
import { InteractiveQuiz } from '@site/src/components/InteractiveQuiz';

<LearningObjective>
Po tej sekcji student potrafi:
- ZaprojektowaÄ‡ tor pomiarowy z odpowiednim kondycjonowaniem sygnaÅ‚u (wzmacnianie, filtracja, liniaryzacja)
- DobraÄ‡ filtr antyaliasingowy z uwzglÄ™dnieniem czÄ™stotliwoÅ›ci Nyquista
- ZapewniÄ‡ izolacjÄ™ galwanicznÄ… i ekranowanie w Å›rodowisku przemysÅ‚owym (EMI/RFI)
- ZidentyfikowaÄ‡ typowe problemy w akwizycji danych (ground loops, aliasing, przesÅ‚uchy) i zastosowaÄ‡ rozwiÄ…zania
</LearningObjective>

<SlideContainer>

<Slide title="âš™ï¸ Kondycjonowanie sygnaÅ‚Ã³w â€“ wprowadzenie" type="info">

<KeyPoints title="ğŸ“‹ Co to jest kondycjonowanie sygnaÅ‚u i dlaczego jest kluczowe?">

**Kondycjonowanie sygnaÅ‚u** (signal conditioning) to proces przygotowania surowego sygnaÅ‚u z czujnika do postaci odpowiedniej dla systemu akwizycji danych (DAQ) lub sterownika (PLC/SCADA).

**GÅ‚Ã³wne cele:**

1. **Dopasowanie poziomÃ³w** â€“ Czujnik: 0-10 mV, ADC: 0-10 V â†’ potrzeba wzmocnienia Ã—1000
2. **Filtracja szumÃ³w** â€“ UsuniÄ™cie zakÅ‚Ã³ceÅ„ EMI/RFI, linii 50/60 Hz, wysokoczÄ™stotliwoÅ›ciowych
3. **Liniaryzacja** â€“ Termopara, NTC majÄ… nieliniowÄ… charakterystykÄ™ â†’ korekta programowa lub sprzÄ™towa
4. **Izolacja galwaniczna** â€“ Przerwanie ground loops, ochrona sprzÄ™tu, bezpieczeÅ„stwo operatora
5. **Ochrona przed przepiÄ™ciami** â€“ Transile voltage suppressors (TVS), ograniczniki, separacja

**Typowy Å‚aÅ„cuch akwizycji danych:**

```mermaid
graph LR
    A[Czujnik<br/>PT1000, 4-20mA, mV] --> B[Conditioning<br/>Amp, Filter, Isolate]
    B --> C[ADC<br/>12/16/24-bit]
    C --> D[Procesor<br/>ÂµC/FPGA/SoC]
    D --> E[Komunikacja<br/>Modbus, OPC UA]
    E --> F[SCADA/<br/>Cloud]
    
    B1[Zasilanie<br/>czujnika] -.-> A
    B2[Masa referencyjna<br/>Ground] -.-> B
    
    style A fill:#ffeb99
    style B fill:#90ee90
    style C fill:#87ceeb
    style D fill:#ffb6c1
    style F fill:#e6e6fa
```

**Problemy bez kondycjonowania:**
- Szumy Â±10% sygnaÅ‚u â†’ dane bezuÅ¼yteczne
- Aliasing (niewÅ‚aÅ›ciwa czÄ™stotliwoÅ›Ä‡ prÃ³bkowania) â†’ faÅ‚szywe czÄ™stotliwoÅ›ci
- Ground loops (pÄ™tle masowe) â†’ przemieszczenie zera o dziesiÄ…tki mV
- PrzepiÄ™cia (pioruny, komutacje) â†’ uszkodzenie ADC/procesora (koszt: setki EUR do tysiÄ™cy)

</KeyPoints>

<SupportingDetails title="ğŸ”§ Kategorie kondycjonowania">

### 1. **Wzmacnianie (Amplification)**

**Wzmacniacz instrumentacyjny (instrumentation amplifier, in-amp):**
- CMRR (Common Mode Rejection Ratio): &gt;100 dB (odrzuca zakÅ‚Ã³cenia wspÃ³lne)
- Wysoka impedancja wejÅ›ciowa (&gt;1 GÎ©) â€“ nie obciÄ…Å¼a czujnika
- Niski szum (&lt;1 ÂµV RMS)
- Typowe wzmocnienia: 1Ã—, 10Ã—, 100Ã—, 1000Ã—

**PrzykÅ‚ad:** Tensometr (strain gauge) z sygnaÅ‚em 0-20 mV â†’ wzmocnienie Ã—500 â†’ 0-10 V dla ADC

### 2. **Filtracja (Filtering)**

**Filtry dolnoprzepustowe (low-pass, LP):**
- Usuwanie wysokoczÄ™stotliwoÅ›ciowych szumÃ³w
- **Antyaliasing** â€“ kluczowe przed ADC (f_cutoff < f_sample/2.5)

**Filtry gÃ³rnoprzepustowe (high-pass, HP):**
- Usuwanie dryftu DC, offsetu
- Blokowanie skÅ‚adowej staÅ‚ej (DC blocking)

**Filtry pasmowoprzepustowe (band-pass, BP):**
- Izolacja konkretnego pasma (np. 10-1000 Hz dla wibracji)

**Filtry notch (band-stop):**
- TÅ‚umienie wÄ…skiego pasma (np. 50 Hz â€“ zakÅ‚Ã³cenia sieciowe)

**Typy implementacji:**
- **Analogowe**: RC pasywne, aktywne (Butterworth, Chebyshev, Bessel)
- **Cyfrowe**: FIR, IIR (po ADC, w procesorze)

### 3. **Liniaryzacja (Linearization)**

**Czujniki nieliniowe:**
- **Termopara** (typu K): U = f(T) nieliniowa â†’ tablica lookup lub wielomian
- **NTC**: R = Râ‚€ exp[Î²(1/T - 1/Tâ‚€)] â†’ Steinhart-Hart equation
- **Flowmeters DP**: Q âˆ âˆšÎ”p â†’ pierwiastek w oprogramowaniu

**Metody:**
- Hardware: ukÅ‚ady log/exp, dzielniki analogowe
- Software: lookup table (LUT), interpolacja, wielomiany

### 4. **Izolacja galwaniczna (Galvanic Isolation)**

**Cel:** Przerwanie poÅ‚Ä…czenia elektrycznego miÄ™dzy czÄ™Å›ciÄ… pomiarowÄ… a sterujÄ…cÄ…

**Technologie:**
- **Transformatory** (magnetic coupling): 1-10 kV izolacji, pasmo DC-MHz (z modulacjÄ…)
- **Optocouplers** (optical isolation): LED + fotodioda, 2.5-5 kV, DC-MHz
- **PojemnoÅ›ciowa** (capacitive): kondensatory jako bariery, wysokie pasmo

**Zastosowania:**
- Przerwanie ground loops
- Ochrona operatora (pomiary wysokiego napiÄ™cia)
- Separacja stref ATEX / non-ATEX

### 5. **Ochrona przed przepiÄ™ciami (Overvoltage Protection)**

**Elementy:**
- **TVS (Transient Voltage Suppressor)**: Diody lawinowe, szybkie (&lt;1 ns)
- **Varistory (MOV)**: Metal Oxide Varistor, dla wyÅ¼szych energii
- **Gas Discharge Tubes (GDT)**: Dla piorunÃ³w (kV), wolniejsze
- **Polyfuses**: Ochrona prÄ…dowa (self-resetting fuses)

**Normy:**
- IEC 61000-4-5 (surge immunity): Poziomy 1-4 (0.5 kV - 4 kV)
- IEC 61326 (EMC dla instrumentacji)

</SupportingDetails>

<InstructorNotes>

**Czas**: 14-16 min

**Przebieg**:
1. Wprowadzenie do kondycjonowania â€“ dlaczego potrzebne? (3 min)
2. Diagram Å‚aÅ„cucha akwizycji (2 min) â€“ omÃ³w kaÅ¼dy blok
3. PrzeglÄ…d kategorii kondycjonowania (7 min) â€“ amplification, filtering, isolation
4. Dyskusja: Jakie problemy studenci widzieli w laboratoriach? (2 min) â€“ ground loops, aliasing
5. Q&A (2 min)

**Punkty kluczowe**:
- **Kondycjonowanie to NIE opcja** â€“ surowy sygnaÅ‚ z czujnika rzadko nadaje siÄ™ bezpoÅ›rednio do ADC
- CMRR >100 dB w in-amp = redukcja zakÅ‚Ã³ceÅ„ o 100 000Ã— (!)
- Filtr antyaliasing PRZED ADC â€“ po ADC juÅ¼ za pÃ³Åºno (aliased frequency nie do odzyskania)
- Izolacja galwaniczna = koszt +50-200 EUR/kanaÅ‚, ale eliminuje ground loops

**Demonstracja praktyczna**:
- PokaÅ¼ oscyloskop: sygnaÅ‚ przed i po filtrowaniu (redukcja szumu 50 Hz)
- In-amp vs. zwykÅ‚y op-amp â€“ rÃ³Å¼nica w CMRR (symulacja lub oscyloskop)
- TVS diode (fizyczny element) â€“ jak wyglÄ…da, charakterystyka I-V

**MateriaÅ‚y pomocnicze**:
- Analog Devices: "A Designer's Guide to Instrumentation Amplifiers" (free PDF)
- TI: "Anti-Aliasing Filters" application note
- Datasheets: AD620 (in-amp), INA128, ISO124 (isolation amplifier)

**Typowe bÅ‚Ä™dy studenckie**:
- MyÅ›lenie, Å¼e filtr cyfrowy (software) zastÄ…pi antyaliasing â€“ NIE! Aliasing siÄ™ juÅ¼ staÅ‚, software nie cofnie
- Ignorowanie ground loops ("przecieÅ¼ wszystko jest uziemione") â€“ problem pojawia siÄ™, gdy masa nie jest wspÃ³lna
- Stosowanie zwykÅ‚ego op-ampa zamiast in-ampa â†’ niski CMRR â†’ zakÅ‚Ã³cenia

**Pytania studenckie**:
- Q: Czemu wzmacniacz instrumentacyjny ma 3 rezystory (differential amp ma 4)?
- A: In-amp to specjalna topologia (2Ã— wzmacniacze buforujÄ…ce + diff amp). Single-resistor gain setting = Å‚atwiejsza kalibracja, matched resistors internal â†’ wysoki CMRR.

- Q: Czy moÅ¼na uÅ¼yÄ‡ filtru RC zamiast Butterworth?
- A: TAK, RC (1st order) to najprostszy LP filtr. Ale: -20 dB/decade roll-off (powolne). Butterworth (4th order) = -80 dB/decade â†’ ostrzejsze odciÄ™cie, lepszy antyaliasing.

</InstructorNotes>

</Slide>

<VisualSeparator type="technical" />

<Slide title="ğŸ“¡ Filtracja antyaliasingowa â€“ kluczowa przed ADC" type="tip">

<KeyConcept title="Twierdzenie o prÃ³bkowaniu (Nyquist-Shannon)">

**Aby prawidÅ‚owo zrekonstruowaÄ‡ sygnaÅ‚ o maksymalnej czÄ™stotliwoÅ›ci f_max, czÄ™stotliwoÅ›Ä‡ prÃ³bkowania musi wynosiÄ‡:**

\[
f_{sample} \geq 2 \times f_{max} \quad \text{(Nyquist rate)}
\]

**W praktyce: f_sample â‰¥ 2.5-5 Ã— f_max** (zapas na nieperfektne filtry)

**Co siÄ™ dzieje jeÅ›li f_sample < 2 Ã— f_max?**

**Aliasing** â€“ wysokie czÄ™stotliwoÅ›ci "zawijajÄ… siÄ™" (fold back) i pojawiajÄ… jako faÅ‚szywe niskie czÄ™stotliwoÅ›ci.

**PrzykÅ‚ad aliasing:**
- SygnaÅ‚ rzeczywisty: f_signal = 900 Hz
- CzÄ™stotliwoÅ›Ä‡ prÃ³bkowania: f_sample = 1000 Hz (za niska!)
- CzÄ™stotliwoÅ›Ä‡ alias: f_alias = |f_signal - f_sample| = |900 - 1000| = **100 Hz**

ADC "widzi" sygnaÅ‚ 100 Hz zamiast 900 Hz â†’ **niemoÅ¼liwe do odzyskania po prÃ³bkowaniu!**

**RozwiÄ…zanie: Filtr antyaliasing (analogowy LP przed ADC)**

\[
f_{cutoff} = \frac{f_{sample}}{2.5} \quad \text{do} \quad \frac{f_{sample}}{5}
\]

**PrzykÅ‚ad (monitoring wibracji):**
- InteresujÄ…ce pasmo: 10 Hz - 5 kHz (BPFO, mesh freq)
- f_sample wybrane: 15 kHz (3Ã— zapas)
- Filtr LP cutoff: f_c = 15000 / 2.5 = **6 kHz** (Butterworth 4th order, -24 dB/octave)

**Dlaczego nie moÅ¼na uÅ¼yÄ‡ filtru cyfrowego?**

Filtr cyfrowy dziaÅ‚a PO ADC â†’ jeÅ›li aliasing juÅ¼ wystÄ…piÅ‚, nie moÅ¼na go cofnÄ…Ä‡. Analogowy filtr PRZED ADC zapobiega dostaniu siÄ™ wysokich czÄ™stotliwoÅ›ci do ADC.

</KeyConcept>

<SupportingDetails title="ğŸ›ï¸ Projektowanie filtru antyaliasing">

### Filtr Butterworth 4th order (aktywny, Sallen-Key topology):

**Charakterystyka:**
- PÅ‚aska charakterystyka w paÅ›mie przepustowym (maximally flat)
- Roll-off: -80 dB/decade (-24 dB/octave)
- Brak tÄ™tnieÅ„ (ripple) w pasmie

**Schemat (uproszczony, single stage = 2nd order):**

```
     R1        R2
Vin --/\/\/\--+--/\/\/\--+-- Vout
              |          |
             C1         C2
              |          |
             GND    Op-Amp (+)
                         |
                    Feedback
```

**Kaskada 2Ã— 2nd order = 4th order**

**DobÃ³r elementÃ³w (dla f_c = 6 kHz):**

WzÃ³r: \( f_c = \frac{1}{2\pi \sqrt{R_1 R_2 C_1 C_2}} \)

Standardowe wartoÅ›ci (dla equal-component Sallen-Key):
- R1 = R2 = 2.7 kÎ©
- C1 = C2 = 10 nF
- f_c = 1 / (2Ï€ Ã— 2700 Ã— 10Ã—10â»â¹) â‰ˆ **5.9 kHz** âœ…

**Op-amp requirements:**
- Bandwidth (GBW): >10Ã— f_c = 60 kHz (typowy op-amp: 1-10 MHz â†’ OK)
- Slew rate: >1 V/Âµs
- Low noise: <10 nV/âˆšHz
- PrzykÅ‚ad: TL072, OPA2134, AD8610

### Weryfikacja filtru (æ¸¬è©¦):

**Frequency response (odpowiedÅº czÄ™stotliwoÅ›ciowa):**
- Pomiar: Network analyzer lub generator funkcyjny + oscyloskop
- SprawdÅº: 
  - @ f_c: attenuation = -3 dB (50% mocy)
  - @ 2Ã—f_c: attenuation = -24 dB (Butterworth 4th order)
  - @ 10Ã—f_c: attenuation = -80 dB

**Test aliasing:**
1. Podaj sygnaÅ‚ f = 15 kHz (= f_sample)
2. Bez filtru: ADC widzi alias @ 0 Hz (DC)
3. Z filtrem: ADC widzi <0.001Ã— amplitudy (-60 dB) â†’ neglectable

</SupportingDetails>

<Example title="Problem i rozwiÄ…zanie: Monitoring wibracji bez antyaliasing">

**Kontekst: Turbina wiatrowa, monitoring wibracji main bearing**

### Konfiguracja bÅ‚Ä™dna (bez filtru antyaliasing):

- Czujnik: Akcelerometr IEPE, pasmo DC-10 kHz
- ADC: 24-bit, f_sample = 5 kHz
- **BRAK filtru LP przed ADC**

### Objaw problemu:

- Analiza FFT pokazuje **dziwne peaki**:
  - 200 Hz (spodziewany: BPFO main bearing) âœ…
  - **300 Hz** (niespodziewany, silny peak)
  - **700 Hz** (niespodziewany, Å›redni peak)

### Diagnoza:

InÅ¼ynier podejrzewa aliasing. Test:
- Zmiana f_sample z 5 kHz â†’ 10 kHz
- Peak 300 Hz **zniknÄ…Å‚**!
- Peak 700 Hz **przesunÄ…Å‚ siÄ™** do 1.2 kHz

**Wniosek:**
- 300 Hz to alias od **4.7 kHz** (EMI z inwertera PWM): |4700 - 5000| = 300 Hz
- 700 Hz to alias od **5.7 kHz** (bearing high-frequency): |5700 - 5000| = 700 Hz

### RozwiÄ…zanie:

**Instalacja filtru LP Butterworth 4th order, f_c = 2 kHz (< f_sample/2.5)**

Po instalacji:
- Peak 300 Hz (alias) **zniknÄ…Å‚** (4.7 kHz zafiltrowane -80 dB)
- Peak 700 Hz (alias) **zniknÄ…Å‚**
- PozostaÅ‚ tylko **200 Hz (BPFO)** + harmoniczne 400, 600 Hz

**Koszty:**
- Filtr (PCB + komponenty): ~30 EUR/kanaÅ‚
- Czas instalacji: 2h
- **Benefit**: Wiarygodne dane, unikniÄ™to false alarm (koszt interwencji serwisowej: ~5000 EUR)

**Lekcja:** Antyaliasing to MUST, nie "nice to have". Koszt filtru << koszt bÅ‚Ä™dnej diagnozy.

</Example>

<InstructorNotes>

**Czas**: 16-18 min (to kluczowa sekcja techniczna!)

**Przebieg**:
1. Twierdzenie Nyquista i aliasing (4 min) â€“ wyjaÅ›nij na przykÅ‚adzie liczbowym
2. Projektowanie filtru Butterworth (5 min) â€“ omÃ³w schemat i dobÃ³r elementÃ³w
3. Case study: aliasing w monitoringu wibracji (5 min) â€“ real-world problem
4. Dyskusja: Czy studenci widzieli aliasing w laboratoriach? (2 min)
5. Q&A (2 min)

**Punkty kluczowe**:
- **Nyquist to PRAWO, nie sugestia** â€“ Å‚amanie prowadzi do aliasing
- Filtr cyfrowy NIE ZASTÄ„PI antyaliasing â€“ musi byÄ‡ analogowy, przed ADC
- Butterworth 4th order to dobry kompromis (flat passband, sharp roll-off)
- f_cutoff = f_sample / 2.5-5 (zapas na nieperfektny filtr)

**Demonstracja praktyczna**:
- Symulacja aliasing: generator 900 Hz + sampling 1 kHz â†’ pokazuje 100 Hz na oscyloskopie
- Bode plot filtru Butterworth (software: LTspice, Matlab, online calculator)
- Comparison: 2nd order (-40 dB/dec) vs. 4th order (-80 dB/dec) â€“ widaÄ‡ rÃ³Å¼nicÄ™

**MateriaÅ‚y pomocnicze**:
- TI: "Understanding Anti-Aliasing Filters" (application note)
- Analog Filter Wizard (online tool: analog.com)
- Example: FFT before/after anti-aliasing filter (spectrum plot)

**Typowe bÅ‚Ä™dy studenckie**:
- MyÅ›lenie, Å¼e f_sample = 2Ã— f_max wystarczy â€“ NO! Potrzeba 2.5-5Ã— zapas (real-world filters aren't perfect)
- Stosowanie 1st order RC (20 dB/dec) jako antyaliasing â†’ za wolny roll-off, potrzeba min. 4th order
- Ignorowanie GBW op-ampa â€“ jeÅ›li GBW < 10Ã— f_c, filtr nie dziaÅ‚a jak Butterworth (gain peaking)

**Pytania studenckie**:
- Q: Czy moÅ¼na uÅ¼yÄ‡ filtru cyfrowego (IIR/FIR) zamiast analogowego?
- A: NIE przed ADC! Cyfrowy dziaÅ‚a po sampling â†’ aliasing juÅ¼ siÄ™ staÅ‚. Cyfrowy MOÅ»E byÄ‡ dodatkowy (po ADC) dla dalszej filtracji.

- Q: Dlaczego Butterworth, a nie Chebyshev (ostrzejszy roll-off)?
- A: Chebyshev ma ripple w passband (Â±1-3 dB) â†’ znieksztaÅ‚ca sygnaÅ‚. Butterworth = maximally flat. Dla antyaliasing: flat passband > steep roll-off (moÅ¼na zwiÄ™kszyÄ‡ order).

</InstructorNotes>

</Slide>

<VisualSeparator type="default" />

<Slide title="ğŸ”Œ Ground loops i izolacja galwaniczna" type="success">

<KeyConcept title="Co to jest ground loop i dlaczego jest problemem?">

**Ground loop (pÄ™tla masowa)** powstaje, gdy dwa urzÄ…dzenia majÄ… rÃ³Å¼ne potencjaÅ‚y "masy" (ground), ale sÄ… poÅ‚Ä…czone przewodem sygnaÅ‚owym.

**Mechanizm:**

```mermaid
graph LR
    A[Czujnik<br/>Ground A] -->|SygnaÅ‚ + zakÅ‚Ã³cenie| B[DAQ<br/>Ground B]
    A -.->|Ground wire<br/>prÄ…d pÄ™tli| B
    
    C[ZakÅ‚Ã³cenie<br/>50Hz, EMI] -.-> A
    C -.-> B
    
    style A fill:#ffeb99
    style B fill:#87ceeb
    style C fill:#ffcccc
```

**RÃ³Å¼nica potencjaÅ‚Ã³w:**
- Ground A: 0.0 V (lokalny)
- Ground B: 0.05 V (lokalny, ale inne miejsce!)
- **RÃ³Å¼nica V_AB = 50 mV** â€“ wpÅ‚ywa na linie 50 Hz, prÄ…dy ziemnozwarciowe

**Efekt na sygnaÅ‚:**
- SygnaÅ‚ nominalny: 10 mV (z tensometru)
- ZakÅ‚Ã³cenie z ground loop: 50 mV (50 Hz + harmoniczne)
- **SNR (signal-to-noise ratio): -14 dB** â†’ dane bezuÅ¼yteczne

**Typowe ÅºrÃ³dÅ‚a rÃ³Å¼nic potencjaÅ‚Ã³w:**
- PrÄ…dy zwarciowe w instalacji elektrycznej
- DÅ‚ugie przewody (10-100 m) â€“ rezystancja Ã— prÄ…d = V_drop
- RÃ³Å¼ne punkty uziemienia
- EMI indukowane w pÄ™tli ground

</KeyConcept>

<SupportingDetails title="ğŸ›¡ï¸ RozwiÄ…zania ground loops">

### Metoda 1: **Single-Point Grounding (Star Ground)**

**Zasada:** Wszystkie urzÄ…dzenia Å‚Ä…czymy do JEDNEGO punktu ground (star point)

```
        Ground Star Point
               |
       ________|________
      |        |        |
   Device1  Device2  Device3
```

**Zalety:** Eliminuje pÄ™tle (brak zamkniÄ™tego obwodu)  
**Wady:** Trudne w duÅ¼ych instalacjach (setki metrÃ³w przewodÃ³w)

### Metoda 2: **Izolacja galwaniczna**

**Zasada:** Przerwanie poÅ‚Ä…czenia elektrycznego miÄ™dzy czujnikiem a DAQ

**Technologie:**
- **Transformatory** (modulated signal through magnetic coupling)
- **Optocouplers** (LED â†’ fotodioda, zero electrical connection)
- **Capacitive isolation** (signal through capacitors)

**PrzykÅ‚ad:** ISO124 (isolation amplifier, Burr-Brown/TI)
- Izolacja: 1500 V RMS continuous
- Pasmo: DC-60 kHz
- Gain: 1Ã—, 10Ã—, 100Ã—
- **Koszt: ~10-15 EUR/szt.**

**Rezultat:** Ground A i Ground B sÄ… **elektrycznie oddzielone** â†’ brak prÄ…du pÄ™tli â†’ brak zakÅ‚Ã³cenia

### Metoda 3: **Differential Signaling (4-20 mA Loop)**

**Zasada:** Przekaz sygnaÅ‚u jako prÄ…d (nie napiÄ™cie) w pÄ™tli rÃ³Å¼nicowej

- Nadajnik (czujnik): konwersja 0-100Â°C â†’ 4-20 mA
- Odbiornik (PLC): pomiar prÄ…du przez rezystor (250 Î©): 4-20 mA â†’ 1-5 V

**Dlaczego dziaÅ‚a?**
- PrÄ…d jest taki sam w caÅ‚ej pÄ™tli (prawo Kirchhoffa)
- ZakÅ‚Ã³cenia napiÄ™ciowe (EMI, ground loops) **nie wpÅ‚ywajÄ… na prÄ…d**
- DÅ‚ugoÅ›Ä‡ przewodu: do 1000 m bez degradacji sygnaÅ‚u

**Standard przemysÅ‚owy:** Czujniki 4-20 mA to workhorse w SCADA (90% instalacji)

### Metoda 4: **Ekranowanie (Shielding)**

**Zasada:** PrzewÃ³d ekranowany (shielded cable) â€“ metalowy oplot wokÃ³Å‚ Å¼yÅ‚ sygnaÅ‚owych

**Topologie:**
- **Ekran uziemiony jednostronnie** (sensor end): Dla f <1 MHz, dÅ‚ugoÅ›Ä‡ <100 m
- **Ekran uziemiony obustronnie** (both ends): Dla f >1 MHz (high-frequency EMI)
- **Ekran floating** (nie podÅ‚Ä…czony): NIE STOSOWAÄ† (shield dziaÅ‚a jak antena!)

**Zasada:** Ekran przechwytuje EMI i odprowadza do ground â†’ sygnaÅ‚ wewnÄ…trz chronionym

### Metoda 5: **Twisted Pair (skrÄ™tka)**

**Zasada:** Dwie Å¼yÅ‚y skrÄ™cone spiralnie â†’ EMI indukuje rÃ³wne napiÄ™cia w obu (common-mode)

- Differential receiver (np. in-amp) odrzuca common-mode (CMRR >100 dB)
- **Rezultat:** EMI eliminowane, tylko rÃ³Å¼nicowy sygnaÅ‚ pozostaje

**Standard:** RS-485 (Modbus RTU), CAN bus, Ethernet â€“ wszystkie uÅ¼ywajÄ… twisted pair

</SupportingDetails>

<Example title="Case study: Ground loop w biogazowni â€“ diagnoza i rozwiÄ…zanie">

**Kontekst: Biogazownia 1 MW, system SCADA**

### Problem zgÅ‚oszony (styczeÅ„ 2023):

- Pomiar temperatury fermenteru (PT1000, 0-100Â°C) pokazuje **dziwne oscylacje Â±2Â°C @ 50 Hz**
- Temperatura rzeczywista: stabilna 40Â°C (weryfikacja rÄ™cznym termometrem)
- **Alarm przeciÄ…Å¼enia** faÅ‚szywie triggeruje (T > 42Â°C threshold)

### Diagnoza (przez inÅ¼yniera automation):

**Krok 1: Pomiar oscyloskopem**
- SygnaÅ‚ PT1000 (linia A-B): 2-wire, 0-10 V (po konwersji Râ†’V)
- Oscyloskop pokazuje: **50 Hz hum, amplituda Â±500 mV** (!)

**Krok 2: Sprawdzenie ground**
- Ground @ czujnik PT1000 (fermenter): 0.00 V (lokalny)
- Ground @ PLC (control room, 50 m dalej): **0.08 V** (50 Hz, 80 mV RMS)
- **Å¹rÃ³dÅ‚o:** PrÄ…d zwarciowy w instalacji elektrycznej (pobliski silnik 15 kW)

**Krok 3: Identyfikacja ground loop**
- PT1000 ma wspÃ³lnÄ… masÄ™ z konstrukcjÄ… fermenteru (ground A)
- PLC ma masÄ™ podÅ‚Ä…czonÄ… do rozdzielnicy elektrycznej (ground B)
- PrzewÃ³d sygnaÅ‚owy 2-wire (signal + ground) â†’ **ground loop!**

```
Fermenter (Ground A) --[PT1000 signal]-- PLC (Ground B)
        |                                        |
        +----[Ground wire with 80mV @ 50Hz]-----+
```

### RozwiÄ…zanie zastosowane:

**Opcja wybrana: Izolacja galwaniczna (isolation amplifier)**

- Zainstalowano: Phoenix Contact MCR-SL-PT100-UI-NC (DIN rail isolation transmitter)
- Specyfikacja:
  - Input: PT100/PT1000, 2/3/4-wire
  - Output: 4-20 mA (isolated)
  - Isolation: 2.5 kV
  - **Koszt: 180 EUR**

**Rezultat:**
- Oscylacje 50 Hz **zniknÄ™Å‚y** (poniÅ¼ej Â±0.1Â°C)
- Ground loop przerwany (PT1000 side vs. PLC side elektrycznie oddzielone)
- Brak false alarms
- **Czas instalacji: 1h** (wymiana w DIN rail)

### Alternatywne rozwiÄ…zania (rozwaÅ¼ane, ale niewyĞ±rane):

1. **4-wire PT1000 z differential input:**
   - Koszt: ~80 EUR (PLC input card)
   - Problem: Ground loop wciÄ…Å¼ istnieje (tylko common-mode rejection)

2. **Star grounding (przeprowadzenie dedykowanego ground):**
   - Koszt: ~500 EUR (50 m przewodu Cu 6 mmÂ², praca)
   - Problem: Interwencja w instalacji elektrycznej (shutdown wymagany)

3. **Wireless transmitter:**
   - Koszt: ~300 EUR
   - Problem: Baterie (wymiana co 2-3 lata), niezawodnoÅ›Ä‡ w ATEX

**Wnioski:**
- Izolacja galwaniczna to **najszybsze i najbardziej niezawodne** rozwiÄ…zanie
- Koszt 180 EUR << koszt false alarms (interwencje serwisowe niepotrzebne: ~500 EUR kaÅ¼da)
- **ROI: <1 miesiÄ…c**

</Example>

<InstructorNotes>

**Czas**: 16-18 min

**Przebieg**:
1. WyjaÅ›nienie ground loops â€“ mechanizm (4 min) â€“ uÅ¼yj diagramu
2. PrzeglÄ…d rozwiÄ…zaÅ„ (6 min) â€“ star ground, isolation, 4-20 mA, shielding
3. Case study biogazowni (5 min) â€“ real-world diagnosis and solution
4. Dyskusja: Czy studenci widzieli 50 Hz hum w laboratoriach? (2 min)
5. Q&A (2 min)

**Punkty kluczowe**:
- **Ground loop to najczÄ™stszy problem w akwizycji przemysÅ‚owej** â€“ kaÅ¼dy inÅ¼ynier to spotka
- RÃ³Å¼nica potencjaÅ‚Ã³w 50-100 mV to NORMA w instalacjach elektrycznych (prÄ…dy zwarciowe)
- Izolacja galwaniczna (isolation amplifier) = 100-200 EUR, ale eliminuje problem raz na zawsze
- 4-20 mA loop to standard przemysÅ‚owy (SCADA) â€“ immune do ground loops i EMI

**Demonstracja praktyczna**:
- Oscyloskop: pokazuje 50 Hz hum w sygnale z ground loop (live lub recording)
- Isolation amplifier (fizyczny moduÅ‚) â€“ jak wyglÄ…da (DIN rail, Phoenix Contact, WeidmÃ¼ller)
- Shielded cable vs. unshielded â€“ przekrÃ³j poprzeczny (pokaÅ¼ oplot ekranujÄ…cy)

**MateriaÅ‚y pomocnicze**:
- Analog Devices: "Grounding and Shielding" (application note MT-031)
- Phoenix Contact: "Isolation technology" catalog (free PDF)
- IEC 61000-5 series â€“ Grounding and earthing (installation guidelines)

**Typowe bÅ‚Ä™dy studenckie**:
- MyÅ›lenie, Å¼e "wszystko uziemione" = brak ground loops â€“ NO! Problem to RÃ“Å»NE potencjaÅ‚y ground
- Stosowanie ekranowania jednostronnie + shield floating (nie podÅ‚Ä…czony) â€“ shield musi byÄ‡ uziemiony!
- Uziemianie ekranu po obu stronach w DC/low-freq â†’ moÅ¼e tworzyÄ‡ pÄ™tlÄ™ (ale dla >1 MHz jest OK)

**Pytania studenckie**:
- Q: Dlaczego 4-20 mA, a nie 0-20 mA?
- A: 4 mA to "live zero" â€“ jeÅ›li przewÃ³d siÄ™ zerwie, odbiornik widzi 0 mA (nie 4 mA) â†’ alarm "sensor fault". Z 0-20 mA: przewÃ³d zerwany = 0 mA = sygnaÅ‚ nominalny (faÅ‚sz!).

- Q: Czy moÅ¼na uÅ¼yÄ‡ wireless (WiFi, Bluetooth) zamiast przewodÃ³w?
- A: TAK, ale: (1) baterie (wymiana, niezawodnoÅ›Ä‡), (2) ATEX (wireless w strefie 0/1 = special certification), (3) latency, (4) interference. W critical applications: przewodowe > wireless.

</InstructorNotes>

</Slide>

<VisualSeparator type="default" />

<Slide title="ğŸ“ Quiz: Kondycjonowanie sygnaÅ‚Ã³w" type="info">

<InteractiveQuiz 
  questions={[
    {
      question: "Akcelerometr generuje sygnaÅ‚ 0-50 mV, ADC wymaga 0-5 V. Jakie wzmocnienie naleÅ¼y zastosowaÄ‡ w wzmacniaczu instrumentacyjnym?",
      options: [
        "10Ã— (0.5 V)",
        "50Ã— (2.5 V)",
        "100Ã— (5 V)",
        "1000Ã— (50 V, za duÅ¼o)"
      ],
      correctAnswer: 2,
      explanation: "Wzmocnienie = V_out / V_in = 5 V / 0.05 V = 100Ã—. Opcja (d) bÅ‚Ä™dna: 50 mV Ã— 1000 = 50 V (saturacja ADC i op-amp!). Zawsze dopasuj wzmocnienie do zakresu ADC."
    },
    {
      question: "System akwizycji wibracji ma f_sample = 10 kHz. Jaka powinna byÄ‡ czÄ™stotliwoÅ›Ä‡ cut-off filtru antyaliasing (Butterworth 4th order)?",
      options: [
        "5 kHz (f_sample / 2, Nyquist)",
        "4 kHz (f_sample / 2.5, zapas)",
        "2 kHz (f_sample / 5, duÅ¼y zapas)",
        "Nie potrzeba filtru, 10 kHz wystarczy"
      ],
      correctAnswer: 1,
      explanation: "f_cutoff = f_sample / 2.5 = 10000 / 2.5 = 4 kHz. Opcja (a) to teoretyczny Nyquist, ale real-world filtry nie sÄ… idealne (slope skoÅ„czony). Opcja (c) to overkill (za duÅ¼o sygnaÅ‚u zafiltrowane). Opcja (d) BÅÄ„D â€“ bez antyaliasing bÄ™dzie aliasing!"
    },
    {
      question: "SygnaÅ‚ 4.5 kHz prÃ³bkowany z f_sample = 5 kHz (BRAK filtru antyaliasing). Jaka czÄ™stotliwoÅ›Ä‡ pojawi siÄ™ w ADC (alias)?",
      options: [
        "4.5 kHz (bez zmian)",
        "500 Hz (|4500 - 5000|)",
        "9.5 kHz (4500 + 5000)",
        "0.5 kHz (4500 / 5000)"
      ],
      correctAnswer: 1,
      explanation: "Aliasing: f_alias = |f_signal - n Ã— f_sample|. Dla n=1: |4500 - 5000| = 500 Hz. SygnaÅ‚ 4.5 kHz 'zawija siÄ™' i pojawia jako 500 Hz w ADC. Opcja (c) to suma (nie dzieje siÄ™). Opcja (d) to dzielenie (niepoprawne)."
    },
    {
      question: "Ground loop powoduje zakÅ‚Ã³cenie 50 Hz w sygnale 10 mV z tensometru. Co jest NAJLEPSZYM rozwiÄ…zaniem?",
      options: [
        "ZwiÄ™kszenie wzmocnienia (amplify signal and noise together)",
        "Filtr notch 50 Hz (tÅ‚umi zakÅ‚Ã³cenie, ale teÅ¼ moÅ¼e sygnaÅ‚)",
        "Izolacja galwaniczna (isolation amplifier, przerywa pÄ™tlÄ™)",
        "SkrÃ³cenie przewodu sygnaÅ‚owego (zmniejsza rezystancjÄ™)"
      ],
      correctAnswer: 2,
      explanation: "Izolacja galwaniczna to root cause fix â€“ przerywa ground loop elektryczne. Opcja (a) wzmacnia teÅ¼ szum (SNR bez zmiany!). Opcja (b) dziaÅ‚a, ale jeÅ›li sygnaÅ‚ ma skÅ‚adowe @ 50 Hz â€“ zostanie zafiltrowany. Opcja (d) pomaga trochÄ™, ale nie eliminuje rÃ³Å¼nicy potencjaÅ‚Ã³w ground."
    },
    {
      question: "Dlaczego w przemyÅ›le stosuje siÄ™ 4-20 mA zamiast 0-10 V do transmisji sygnaÅ‚Ã³w?",
      options: [
        "4-20 mA jest taÅ„sze (mniejsze komponenty)",
        "4-20 mA jest immune do zakÅ‚Ã³ceÅ„ EMI i ground loops (prÄ…d staÅ‚y w pÄ™tli)",
        "4-20 mA ma wiÄ™kszÄ… dokÅ‚adnoÅ›Ä‡ (Â±0.01%)",
        "4-20 mA nie wymaga zasilania czujnika"
      ],
      correctAnswer: 1,
      explanation: "PrÄ…d w pÄ™tli jest taki sam niezaleÅ¼nie od spadkÃ³w napiÄ™cia (EMI, ground loops). 4 mA to 'live zero' (zerwany przewÃ³d = 0 mA = alarm). 0-10 V wraÅ¼liwe na zakÅ‚Ã³cenia napiÄ™ciowe. Opcja (c) nieprawda (dokÅ‚adnoÅ›Ä‡ zaleÅ¼y od DAC/ADC). Opcja (d) nieprawda (4-20 mA wymaga power supply, np. 24 V)."
    }
  ]}
/>

:::tip Rekomendacja po quizie
JeÅ›li uzyskaÅ‚eÅ› <80% poprawnych odpowiedzi, przejrzyj sekcje o twierdzeniu Nyquista (aliasing), ground loops i rÃ³Å¼nicy miÄ™dzy 4-20 mA vs. 0-10 V. Zrozumienie kondycjonowania sygnaÅ‚Ã³w jest fundamentem wiarygodnego monitoringu w Å›rodowisku przemysÅ‚owym.
:::

</Slide>

</SlideContainer>

---

## Podsumowanie i wnioski

**Kluczowe punkty z tej sekcji:**

1. **Kondycjonowanie sygnaÅ‚u to NIE opcja** â€“ surowy sygnaÅ‚ z czujnika rzadko nadaje siÄ™ bezpoÅ›rednio do ADC. Wymaga: wzmacniania, filtracji, liniaryzacji, izolacji.

2. **Filtr antyaliasing (analogowy LP przed ADC) jest OBOWIÄ„ZKOWY** â€“ po sampling aliased frequency nie jest do odzyskania. f_cutoff = f_sample / 2.5-5, Butterworth 4th order to dobry wybÃ³r.

3. **Ground loops to najczÄ™stszy problem w przemyÅ›le** â€“ rÃ³Å¼nice potencjaÅ‚Ã³w ground (50-100 mV @ 50 Hz) indukujÄ… zakÅ‚Ã³cenia. RozwiÄ…zania:
   - Izolacja galwaniczna (isolation amplifier): 100-200 EUR, eliminuje problem
   - 4-20 mA loops: standard SCADA, immune do EMI/ground loops
   - Ekranowanie + twisted pair: redukcja, ale nie eliminacja

4. **Wzmacniacz instrumentacyjny (in-amp) > zwykÅ‚y op-amp** â€“ CMRR >100 dB eliminuje zakÅ‚Ã³cenia common-mode. Koszt: 2-10 EUR/szt. (AD620, INA128).

5. **Topologie 4-wire dla czujnikÃ³w rezystancyjnych** (PT100/1000) â€“ kompensacja rezystancji przewodÃ³w, kluczowe dla dÅ‚ugich dystansÃ³w (>10 m).

6. **Ochrona przed przepiÄ™ciami** (TVS, varistory) â€“ koszt 1-5 EUR, ale ratuje sprzÄ™t za setki/tysiÄ…ce EUR (ADC, procesory).

**Typowe bÅ‚Ä™dy do unikania:**
- Brak filtru antyaliasing â†’ aliasing â†’ faÅ‚szywe czÄ™stotliwoÅ›ci
- Ignorowanie ground loops â†’ zakÅ‚Ã³cenia 50 Hz â†’ dane bezuÅ¼yteczne
- Stosowanie zwykÅ‚ego op-ampa zamiast in-amp â†’ niski CMRR â†’ wraÅ¼liwoÅ›Ä‡ na EMI
- Ekran floating (nie podÅ‚Ä…czony) â†’ shield dziaÅ‚a jak antena

**NastÄ™pne kroki:**
- Ä†wiczenie 6: Projekt toru pomiarowego (czujnik â†’ conditioning â†’ ADC â†’ ÂµC) z symulacjÄ… w LTspice/Matlab
- Lab hands-on: Budowa filtru antyaliasing, test z generatorem i oscyloskopem
- Przygotowanie do egzaminu: PowtÃ³rka caÅ‚ego wykÅ‚adu 02 (czujniki + akwizycja)

---

**Dodatkowe zasoby:**
- **Analog Devices**: "A Designer's Guide to Instrumentation Amplifiers" (MT-070)
- **TI**: "Understanding Data Converters" (SLAA013)
- **Ott, Henry**: "Electromagnetic Compatibility Engineering" (ksiÄ…Å¼ka, biblia EMC)
- **IEC 61326** â€“ EMC requirements for electrical equipment for measurement
- **Grounding and Shielding** (Ralph Morrison) â€“ klasyk, praktyczne podejÅ›cie
