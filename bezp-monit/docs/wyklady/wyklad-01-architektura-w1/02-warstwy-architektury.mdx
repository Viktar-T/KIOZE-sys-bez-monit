---
title: "Warstwy architektury: edgeâ€“fogâ€“cloud"
sidebar_position: 2
---

import { LearningObjective, KeyConcept, Example } from '@site/src/components/SlideComponents';
import InteractiveQuiz from '@site/src/components/InteractiveQuiz';

# Warstwy architektury: edgeâ€“fogâ€“cloud

<LearningObjective>
Po tej sekcji student potrafi scharakteryzowaÄ‡ trzy warstwy architektury monitoringu (edge, fog, cloud), przypisaÄ‡ im odpowiednie funkcje i wyjaÅ›niÄ‡, jak decyzje architektoniczne wpÅ‚ywajÄ… na niezawodnoÅ›Ä‡, opÃ³Åºnienia i retencjÄ™ danych.
</LearningObjective>

## Wprowadzenie: Dlaczego warstwowa architektura?

Systemy monitoringu OZE ewoluowaÅ‚y od **prostych rozwiÄ…zaÅ„ scentralizowanych** (wszystko w jednym SCADA w serwerowni) do **architektur rozproszonych**, ktÃ³re dzielÄ… odpowiedzialnoÅ›ci miÄ™dzy **edge, fog i cloud**. Ta ewolucja byÅ‚a napÄ™dzana przez:

- **SkalÄ™**: Nowoczesne farmy PV to tysiÄ…ce punktÃ³w pomiarowych, farmy wiatroweâ€”setki turbin rozproszonych na dziesiÄ…tkach kilometrÃ³w
- **ÅÄ…cznoÅ›Ä‡**: PoÅ‚Ä…czenia 4G/5G sÄ… nie zawsze dostÄ™pne (odlegÅ‚e lokalizacje) i kosztowne (transfer terabajt Ã³w surowych danych)
- **OpÃ³Åºnienia**: ReguÅ‚y bezpieczeÅ„stwa (np. odciÄ™cie zasilania przy przekroczeniu progÃ³w) wymagajÄ… reakcji w **milisekundach**, nie sekundach
- **NiezawodnoÅ›Ä‡**: Utrata Å‚Ä…cznoÅ›ci z chmurÄ… nie moÅ¼e sparaliÅ¼owaÄ‡ krytycznych funkcji (alarmy, sterowanie lokalne)
- **BezpieczeÅ„stwo**: Segregacja poziomÃ³w dostÄ™pu (edge/fog w OTâ€”Operational Technology, cloud w ITâ€”Information Technology) zgodnie z IEC 62443

<KeyConcept title="Architektura edge-fog-cloud a Purdue Model">
Model Purdue (ISA-95) definiuje hierarchiÄ™ automatyki przemysÅ‚owej w 5 poziomach (0â€”czujniki, 1â€”sterowanie, 2â€”nadzÃ³r, 3â€”MES, 4â€”ERP). W OZE:
- **Edge** â‰ˆ Poziomy 0â€“1 (czujniki + akwizycja + lokalne PLC)
- **Fog** â‰ˆ Poziomy 2â€“3 (SCADA lokalne, HMI, krÃ³tkoterminowa analityka)
- **Cloud** â‰ˆ Poziom 4+ (zarzÄ…dzanie flotÄ…, long-term analytics, integracja z systemami biznesowymi)
</KeyConcept>

<details>
<summary>ğŸ“ Notatki prowadzÄ…cego</summary>

**Czas**: 8 minut

**Przebieg**:
1. Wprowadzenie do koncepcji warstwowej architektury (3 min)
2. Pokazanie schematu Purdue Model na tablicy lub slajdzie (2 min)
3. Pytanie do sali: "Dlaczego nie moÅ¼emy mieÄ‡ wszystkiego w chmurze?" (3 minâ€”dyskusja)

**Punkty kluczowe**:
- **Ewolucja**: Od SCADA monolitycznych (lata 90.â€“2000.) do architektury rozproszonej (2010.+)
- **Analogia do IT**: Edge-fog-cloud to odpowiednik edge computing w IoT/przemyÅ›le 4.0
- **BezpieczeÅ„stwo cybernetyczne**: Segregacja OT/IT chroni przed propagacjÄ… atakÃ³w

**Pytania studenckie**:
- Q: Czy w maÅ‚ej instalacji (np. 100 kW PV) teÅ¼ potrzebujemy trzech warstw?
- A: Niekoniecznie. MaÅ‚e instalacje czÄ™sto korzystajÄ… z rozwiÄ…zaÅ„ cloud-first (inwerter â†’ WiFi â†’ chmura producenta). Ale nawet tam, inwerter peÅ‚ni rolÄ™ edge (lokalna logika MPPT, ochrony).

- Q: Co to dokÅ‚adnie znaczy "fog"? To niejasny termin.
- A: Zgoda, nazwa jest marketingowa (Cisco). W praktyce: "fog = lokalny serwer/gateway z moÅ¼liwoÅ›ciami analitycznymi, ktÃ³ry nie jest ani w urzÄ…dzeniu koÅ„cowym (edge), ani w centrum danych (cloud)".

</details>

---

## Warstwa Edge: Blisko czujnikÃ³w i sterownikÃ³w

**Warstwa edge** to **pierwszy punkt kontaktu** miÄ™dzy Å›wiatem fizycznym (czujniki, aktuatory) a systemem cyfrowym. W instalacjach OZE, edge obejmuje:

- **Gateway IoT**: ModuÅ‚owe urzÄ…dzenia (Raspberry Pi, Siemens IOT2040, Moxa UC-8100) zbierajÄ…ce dane przez Modbus RTU/TCP, CAN bus, Ethernet/IP
- **Sterowniki PLC**: Programowalne sterowniki logiczne (np. Siemens S7-1200, Allen-Bradley CompactLogix) z wbudowanymi I/O i logikÄ…
- **Smart invertery i BMS**: UrzÄ…dzenia z wbudowanymi moÅ¼liwoÅ›ciami komunikacyjnymi (Modbus TCP, Sunspec, OPC UA)
- **Lokalne HMI**: Panele operatorskie (touchscreeny) dla obsÅ‚ugi na miejscu

### Funkcje i odpowiedzialnoÅ›ci warstwy edge

#### 1. Akwizycja danych (Data Acquisition)

Edge zbiera **surowe sygnaÅ‚y** z czujnikÃ³w (napiÄ™cia, prÄ…dy, temperatury, ciÅ›nienia) i konwertuje je na **wartoÅ›ci fizyczne** (W, V, A, Â°C, Pa). Typowe czÄ™stotliwoÅ›ci prÃ³bkowania:
- **Standardowe parametry**: 1â€“10 Hz (moc, napiÄ™cia, temperatury)
- **Analizy drganiowe (CMS)**: 10â€“50 kHz (widma FFT dla diagnostyki Å‚oÅ¼ysk)
- **Zdarzenia**: Event-driven (przeÅ‚Ä…czenia, alarmy)

**Kluczowe wymaganie**: **Synchronizacja czasu** (NTPâ€”Network Time Protocol, dokÅ‚adnoÅ›Ä‡ < 10 ms) dla korelacji zdarzeÅ„ miÄ™dzy urzÄ…dzeniami.

#### 2. WstÄ™pna filtracja i walidacja

Nie wszystkie surowe dane sÄ… wartoÅ›ciowe. Edge wykonuje:
- **FiltracjÄ™ antyaliasingowÄ…** (filtry Butterwortha, Chebyszeva) przed samplingiem
- **Usuwanie szumÃ³w**: Filtry medianowe, moving average dla wolno zmieniajÄ…cych siÄ™ sygnaÅ‚Ã³w
- **WalidacjÄ™ zakresÃ³w**: Odrzucanie wartoÅ›ci poza granicami fizycznymi (np. temperatura < -50Â°C lub > 150Â°C dla czujnikÃ³w w OZE)
- **Dead-band filtering**: Ignorowanie zmian < delta (np. transmit tylko gdy zmiana temperatury > 0.5Â°C) â†’ redukcja ruchu sieciowego

#### 3. Normalizacja jednostek

RÃ³Å¼ne urzÄ…dzenia raportujÄ… w rÃ³Å¼nych jednostkach. Edge standaryzuje:
- Moc: W â†’ kW
- Energia: Wh â†’ kWh
- Irradiancja: W/mÂ² (bez konwersjiâ€”standard)
- Temperatura: Â°C (Europa) lub Â°F (USA) â†’ zawsze konwertuj do jednej

#### 4. Buforowanie (buffering)

Edge utrzymuje **lokalny bufor** (zwykle RAM lub flash, 1â€“24 h danych) na wypadek utraty Å‚Ä…cznoÅ›ci z fog/cloud. Po przywrÃ³ceniu Å‚Ä…cznoÅ›ci, dane sÄ… **synchronizowane** (store-and-forward).

**PrzykÅ‚ad**: Gateway IoT na farmie PV w gÃ³rach traci Å‚Ä…cznoÅ›Ä‡ LTE na 3 godziny (burza). Bufor przechowuje dane 1-minutowe (180 rekordÃ³w). Po przywrÃ³ceniu Å‚Ä…cznoÅ›ci, dane sÄ… wysÅ‚ane partiami do SCADA fog.

#### 5. Lokalne reguÅ‚y alarmowe

Krytyczne alarmy **nie mogÄ… czekaÄ‡** na decyzjÄ™ z chmury. Edge wykonuje:
- **Progi statyczne**: Np. temperatura BESS > 60Â°C â†’ stop charging
- **Logika interlockingu**: Np. w biogazowni: jeÅ›li Hâ‚‚S > 1000 ppm â†’ zamknij zawory dopÅ‚ywu, uruchom alarm
- **Restart automatyczny**: Po ustÄ…pieniu przyczyny alarmu (np. temperatura spadÅ‚a do < 55Â°C), wznowienie normalnej pracy

:::tip Kluczowa zasada bezpieczeÅ„stwa
**Safety-critical logic must run locally (edge/fog), not in the cloud.** OpÃ³Åºnienie do chmury moÅ¼e wynosiÄ‡ 100â€“500 ms (plus ryzyko utraty Å‚Ä…cznoÅ›ci). Dla bezpieczeÅ„stwa ludzi i sprzÄ™tu, reakcja musi byÄ‡ < 100 ms.
:::

### Ograniczenia warstwy edge

- **Zasoby obliczeniowe**: Edge devices majÄ… ograniczone CPU/RAM (typowo ARM Cortex-A9, 512 MBâ€“2 GB RAM). Nie nadajÄ… siÄ™ do zÅ‚oÅ¼onych analiz ML.
- **Brak kontekstu globalnego**: Edge zna tylko lokalne dane (jedna turbina, jeden inverter). Nie widzi korelacji miÄ™dzy obiektami.
- **TrudnoÅ›Ä‡ aktualizacji**: Firmware update na 100 gatewayach to wyzwanie logistyczne.

<Example title="Konfiguracja edge gateway: Farma PV 1 MW">
**Hardware**: Raspberry Pi 4 (4 GB RAM) + HAT Modbus RTU (RS-485)

**Funkcje**:
- Zbieranie danych z 4 inverterÃ³w (SMA Sunny Tripower) przez Modbus TCP, co 10 s
- Normalizacja: moc AC w W â†’ kW
- Walidacja: odrzucanie PR > 1.2 (bÅ‚Ä…d czujnika lub danych)
- Bufor lokkalny: SQLite, 48 h danych
- WysyÅ‚ka do fog: MQTT, topic `pv/site-001/inverters/{id}/power`, co 1 min (agregacja Å›rednia z 6 prÃ³bek)
- Alarm lokalny: jeÅ›li moc AC = 0 przy irradiancji > 200 W/mÂ² przez > 5 min â†’ SMS do serwisu (przez modem LTE)

**Koszt**: ~â‚¬300 (hardware) + â‚¬15/miesiÄ…c (4G data plan)
</Example>

<details>
<summary>ğŸ“ Notatki prowadzÄ…cego</summary>

**Czas**: 12 minut

**Przebieg**:
1. PrzeglÄ…d funkcji edge (6 min, po ~1 min kaÅ¼da)
2. PrzykÅ‚ad gateway (3 min)â€”jeÅ›li masz fizyczny Raspberry Pi + HAT, pokaÅ¼ na zajÄ™ciach!
3. Dyskusja: Jakie alarmy powinny byÄ‡ lokalne, a jakie mogÄ… czekaÄ‡? (3 min)

**Punkty kluczowe**:
- **Edge to nie "tylko zbieranie"**: To inteligentne przetwarzanie bliskie ÅºrÃ³dÅ‚u
- **Store-and-forward**: Kluczowa funkcja dla niezawodnoÅ›ci w sÅ‚abej Å‚Ä…cznoÅ›ci (farmy wiejskie, offshore)
- **BezpieczeÅ„stwo > efektywnoÅ›Ä‡**: Zawsze priorytet dla lokalnych alarmÃ³w

**Pytania studenckie**:
- Q: Jakie protokoÅ‚y sÄ… najpopularniejsze na edge?
- A: Modbus RTU/TCP (legacy, ale wciÄ…Å¼ dominujÄ…cy w PV/wiatr), OPC UA (nowsze, trend przemysÅ‚owy), MQTT (IoT, lekki), BACnet (HVAC, ale rzadko w OZE).

- Q: Czy edge moÅ¼e dziaÅ‚aÄ‡ bez internetu?
- A: Tak! To kluczowa cecha. Edge + fog mogÄ… dziaÅ‚aÄ‡ w trybie "island mode" (bez chmury) przez tygodnie. Cloud jest do long-term analytics, nie do kontroli procesu.

</details>

---

## Warstwa Fog: Lokalna konsolidacja i analityka

**Warstwa fog** to **poÅ›redni poziom** miÄ™dzy edge a cloud, ktÃ³ry agreguje dane z wielu urzÄ…dzeÅ„ edge, wykonuje lokalnÄ… analitykÄ™ i buforuje dane na wypadek utraty Å‚Ä…cznoÅ›ci z chmurÄ…. W praktyce, fog to:

- **Serwer SCADA lokalny**: PC przemysÅ‚owy (IPC) z oprogramowaniem SCADA (Ignition, WinCC, Citect) w szafie sterowniczej lub kontenerze technicznym
- **Edge server**: PotÄ™Å¼niejszy gateway (Dell Edge Gateway 5000, HPE Edgeline) z moÅ¼liwoÅ›ciami wirtualizacji (Docker, K3s)
- **Lokalna baza danych**: TSDB (Time-Series Database) jak InfluxDB, TimescaleDB, Historian (OSIsoft PI, GE Proficy)

### Funkcje i odpowiedzialnoÅ›ci warstwy fog

#### 1. Agregacja wielu ÅºrÃ³deÅ‚

Fog zbiera dane z **dziesiÄ…tek do setek** urzÄ…dzeÅ„ edge:
- Farma PV 10 MW: 40 inverterÃ³w + 5 weather stations + 10 string combiner boxes â†’ 55 ÅºrÃ³deÅ‚
- Farma wiatrowa 30 MW: 10 turbin (kaÅ¼da z ~500 tagÃ³w SCADA) â†’ 5000 tagÃ³w

**ProtokoÅ‚y na poziomie fog**: Modbus TCP, OPC UA (najlepszy dla interoperacyjnoÅ›ci), MQTT (subscribe do wszystkich topics edge).

#### 2. Normalizacja tagÃ³w (Tag Naming & Structuring)

RÃ³Å¼ne producenty inwerterÃ³w uÅ¼ywajÄ… rÃ³Å¼nych nazw tagÃ³w:
- SMA: `Pac` (moc AC)
- Fronius: `P_AC_Total`
- Huawei: `active_power`

Fog mapuje wszystkie do **jednolitej nomenklatury** (np. zgodnej z IEC 61850):
```
site-001.inverter-01.power.ac.total
site-001.inverter-02.power.ac.total
...
```

Struktura hierarchiczna uÅ‚atwia:
- **Automatyczne dashboardy** (Grafana queries dla `site-*.inverter-*.power.ac.total`)
- **Alarmy globalne** (suma mocy < 80% oczekiwanej)

#### 3. KrÃ³tkoterminowe skÅ‚adowanie (Short-Term Historian)

Fog przechowuje **szczegÃ³Å‚owe dane** (1-s, 10-s interval) przez **godziny do tygodni**:
- **Zwykle**: 7â€“30 dni danych wysokiej rozdzielczoÅ›ci
- **Technologia**: InfluxDB, TimescaleDB (open-source), OSIsoft PI (komercyjne, drogie ale potÄ™Å¼ne)

Po tym okresie, dane sÄ…:
- **Agregowane** (Å›rednia 1-min â†’ 15-min) i wysyÅ‚ane do cloud
- **Lub usuwane** (jeÅ›li nie sÄ… potrzebne long-term)

**Przypadek uÅ¼ycia**: Analiza szczegÃ³Å‚owa awarii (np. sekwencja zdarzeÅ„ podczas trip invertera) wymaga danych 1-s. Fog dostarcza ten poziom szczegÃ³Å‚owoÅ›ci lokalnie, bez potrzeby Å›ciÄ…gania terabajtÃ³w z chmury.

#### 4. Analityka bliska procesowi (Near-Real-Time Analytics)

Fog ma zasoby obliczeniowe (CPU 8-core, RAM 16-64 GB) do:
- **Kalkulacji KPI**: PR, Availability, Capacity Factor w czasie rzeczywistym (okna ruchome 15-min, 1-h, 24-h)
- **Detekcji anomalii**: Proste algorytmy (progi adaptacyjne, CUSUM, reguÅ‚y eksperckie)
- **Wizualizacji lokalnej**: HMI dla operatorÃ³w na miejscu (ekrany w control room)

**PrzykÅ‚ad**: Fog oblicza PR dla kaÅ¼dego invertera co 15 minut. JeÅ›li PR invertera < 0.75 (podczas gdy inne majÄ… > 0.85), generuje alarm "Suspected underperformanceâ€”Inverter 12".

#### 5. Cache i synchronizacja z cloud

Fog dziaÅ‚a jak **cache warstwy danych** miÄ™dzy edge a cloud:
- **Upload do cloud**: Dane zagregowane (15-min averages), KPI, alarmy
- **Download z cloud**: Aktualizacje konfiguracji (nowe progi alarmowe, logika), modele ML (np. model predykcji produkcji)

**ProtokoÅ‚y synchronizacji**: MQTT (publish agregat Ã³w), REST API (POST batch records), Kafka (event streaming dla duÅ¼ych wdroÅ¼eÅ„).

:::note Fog vs. Edge: Jak rozrÃ³Å¼niÄ‡?
**Zasada**: JeÅ›li urzÄ…dzenie **agreguje dane z wielu ÅºrÃ³deÅ‚** i ma **lokalnÄ… bazÄ™ danych** â†’ to fog. JeÅ›li **zbiera z jednego urzÄ…dzenia** i ma tylko bufor â†’ to edge. Granica jest pÅ‚ynna (szczegÃ³lnie w maÅ‚ych instalacjach).
:::

### Decyzje architektoniczne dla fog

| Aspekt | Opcja A | Opcja B | Zalecenie |
|--------|---------|---------|-----------|
| **Hardware** | PC przemysÅ‚owy (IPC) | Serwer rack (Dell, HPE) | IPC dla < 50 urzÄ…dzeÅ„ edge, serwer dla > 50 |
| **SCADA Software** | Open-source (Ignition, FUXA) | Komercyjne (Siemens WinCC) | Open-source dla nowych projektÃ³w (niski OPEX), komercyjne jeÅ›li wymagana certyfikacja |
| **Historian** | InfluxDB (OSS) | OSIsoft PI | InfluxDB dla OZE (doskonaÅ‚a wydajnoÅ›Ä‡ dla TSDB), PI dla integracji z legacy systems |
| **ÅÄ…cznoÅ›Ä‡** | 4G/5G | Ethernet (fiber/wireless point-to-point) | Fiber jeÅ›li dostÄ™pne (wyÅ¼sze SLA), 4G jako backup |

<Example title="Architektura fog: Biogazownia 1 MW">
**Hardware**: Dell Edge Gateway 5100 (Intel Atom x5, 8 GB RAM, 128 GB SSD)

**Funkcje**:
1. **Agregacja**: Dane z PLC (Siemens S7-1200) przez OPC UA
   - 50 tagÃ³w procesowych: temperatury fermentatorÃ³w, przepÅ‚ywy CHâ‚„/Hâ‚‚S, ciÅ›nienia, poziomy cieczy
   - CzÄ™stotliwoÅ›Ä‡: 5 s
2. **Historian**: InfluxDB 2.x, retencja 30 dni (szczegÃ³Å‚owe), 1 rok (15-min aggregates)
3. **Analityka**:
   - Kalkulacja OEE co 1 h
   - Detekcja anomalii: stÄ™Å¼enie CHâ‚„ < 50% przez > 2 h â†’ alarm "Low methane content"
   - Prognoza produkcji energii na kolejne 24 h (model ARIMA w Pythonie, uruchamiany co 6 h)
4. **HMI lokalne**: Grafana dashboard (10-calowy touchscreen w control room)
5. **Synchronizacja z cloud**: MQTT do AWS IoT Core, dane 15-min + alarmy

**Koszt**: â‚¬5000 (hardware + licenses) + â‚¬50/miesiÄ…c (cloud uplink)
</Example>

<details>
<summary>ğŸ“ Notatki prowadzÄ…cego</summary>

**Czas**: 14 minut

**Przebieg**:
1. PrzeglÄ…d funkcji fog (7 min)
2. Tabela decyzyjna (2 min)â€”warto przygotowaÄ‡ slajd
3. PrzykÅ‚ad biogazowni (3 min)
4. Pytanie do sali: "Czy kaÅ¼da instalacja OZE potrzebuje warstwy fog?" (2 min)

**Punkty kluczowe**:
- **Fog to "mÃ³zg lokalny"**: Decyzje, ktÃ³re wymagajÄ… kontekstu wielu urzÄ…dzeÅ„, ale nie mogÄ… czekaÄ‡ na chmurÄ™
- **Historian â‰  backup**: To narzÄ™dzie analityczne, nie archiwum (cloud peÅ‚ni rolÄ™ archiwum)
- **Open-source wygraÅ‚ w OZE**: InfluxDB, Grafana, Node-RED to de facto standardy w nowych projektach (vs. Siemens, Schneider w legacy)

**Pytania studenckie**:
- Q: Dlaczego nie pominÄ…Ä‡ fog i wysyÅ‚aÄ‡ wszystko z edge do cloud?
- A: MoÅ¼na, dla maÅ‚ych instalacji (< 1 MW). Dla wiÄ™kszych: (1) koszty transferu danych, (2) opÃ³Åºnienia, (3) resilience (fog dziaÅ‚a gdy cloud offline).

- Q: Co siÄ™ dzieje, gdy fog upadnie (awaria hardware)?
- A: Edge buforuje dane i wysyÅ‚a bezpoÅ›rednio do cloud (jeÅ›li jest Å‚Ä…cznoÅ›Ä‡). Ale lokalny HMI i near-RT analytics sÄ… niedostÄ™pne â†’ wymaga wizyty serwisu. Dlatego: redundancja fog (active-standby) dla instalacji > 10 MW.

</details>

---

## Warstwa Cloud: DÅ‚ugoterminowe skÅ‚adowanie i analityka zaawansowana

**Warstwa cloud** to **centralne repozytorium danych** i **platforma analityki zaawansowanej** dla jednej lub wielu instalacji OZE. W przeciwieÅ„stwie do edge/fog, cloud moÅ¼e byÄ‡:
- **Publiczny**: AWS IoT, Azure IoT Hub, Google Cloud IoT
- **Prywatny**: On-premise data center operatora (dla duÅ¼ych portfoliÃ³w, np. > 100 MW)
- **Hybrydowy**: WraÅ¼liwe dane (OT) on-premise, analityka (IT) w chmurze publicznej

### Funkcje i odpowiedzialnoÅ›ci warstwy cloud

#### 1. DÅ‚ugoterminowe skÅ‚adowanie (Long-Term Data Lake/Warehouse)

Cloud przechowuje **lata danych** w formacie skompresowanym:
- **Retencja**: 5â€“10 lat (wymogi compliance, audyty, refinansowanie projektÃ³w)
- **RozdzielczoÅ›Ä‡**: 15-min aggregates (wystarczajÄ…ce dla analiz statystycznych, raportÃ³w)
- **Technologia**: S3 (AWS), Blob Storage (Azure) + Parquet format (kompresja 10:1 vs. CSV)

**Koszty**: ~â‚¬0.01â€“0.03/GB/miesiÄ…c (S3 Standard-IA). Dla farmy 10 MW generujÄ…cej 1 GB/dzieÅ„ danych zagregowanych: **~â‚¬10â€“30/miesiÄ…c** na storage.

#### 2. Raporty i dashboardy dla stakeholders

Cloud dostarcza **dashboardy biznesowe** (nie operacyjneâ€”te sÄ… w fog):
- **Dla inwestorÃ³w**: Produkcja vs. plan, ROI, IRR
- **Dla O&M**: Availability, MTBF, top-10 alarmÃ³w
- **Dla OSP/regulatora**: Compliance reports (dostÄ™pnoÅ›Ä‡, curtailment events)

**NarzÄ™dzia**: Power BI, Tableau, Grafana Cloud, custom web apps (React + REST API).

#### 3. Uczenie maszynowe i AI

Cloud ma zasoby obliczeniowe (GPU, TPU) do:
- **Predykcja produkcji**: Modele ML (XGBoost, LSTM) przewidujÄ… produkcjÄ™ PV/wiatr na 1â€“7 dni (input: prognozy pogodowe)
- **Detekcja anomalii**: Unsupervised learning (PCA, autoencoders) wykrywa subtelne degradacje (np. PID w PV, blade imbalance w wietrze)
- **Optymalizacja O&M**: Algorytmy planujÄ… optymalne trasy serwisowe (minimalizacja kosztÃ³w + maksymalizacja uptime)

**PrzykÅ‚ad**: Model LSTM trained on 2 years of PV production + weather data przewiduje produkcjÄ™ na jutro z MAE < 5%. Operator uÅ¼ywa prognozy do planowania mycia moduÅ‚Ã³w (w dni o przewidywanej niskiej produkcji).

#### 4. PorÃ³wnania miÄ™dzyobiektowe (Benchmarking)

Cloud agreguje dane z **wielu instalacji** (farmy w portfolio operatora):
- **KPI benchmarking**: KtÃ³ra farma ma najwyÅ¼szy PR? NajniÅ¼szÄ… Availability?
- **Best practices**: Transfer wiedzy z najlepiej dziaÅ‚ajÄ…cych obiektÃ³w
- **Fleet-wide alerts**: Wykrycie problemÃ³w systemowych (np. bug w firmware inverterÃ³w tego samego modelu w 10 farmach)

#### 5. Integracja z systemami biznesowymi

Cloud Å‚Ä…czy monitoring OZE z:
- **ERP**: Koszty serwisu, zamÃ³wienia czÄ™Å›ci zamiennych, faktury
- **CMMS** (Computerized Maintenance Management System): Zlecenia serwisowe, harmonogramy, Å›ledzenie SLA kontraktÃ³w
- **OSP portals**: Automatyczne raportowanie do Operator Systemu PrzesyÅ‚owego (compliance, availability, curtailment)

### Decyzje architektoniczne dla cloud

| Aspekt | Pytanie | OdpowiedÅº/Zalecenie |
|--------|---------|---------------------|
| **Vendor lock-in** | Publiczny cloud (AWS, Azure) czy private? | Publiczny dla < 100 MW (niÅ¼sze CapEx), private dla > 100 MW (niÅ¼sze OpEx long-term, kontrola) |
| **BezpieczeÅ„stwo** | Jak chroniÄ‡ OT data w chmurze? | Szyfrowanie end-to-end (TLS 1.3), segregacja sieci (VPC), IAM (role-based access), compliance (ISO 27001) |
| **Koszty** | Jak kontrolowaÄ‡ cloud spend? | (1) Agreguj dane w fog (nie wysyÅ‚aj raw 1-s data), (2) uÅ¼ywaj S3 lifecycle policies (archive do Glacier po 1 roku), (3) reserved instances dla staÅ‚ych obciÄ…Å¼eÅ„ |
| **Latency** | Czy cloud moÅ¼e sterowaÄ‡ procesem? | **Nie** (z wyjÄ…tkami: demand response z tolerancjÄ… opÃ³ÅºnieÅ„ > 1 min). Sterowanie real-time = edge/fog |

<KeyConcept title="Cloud nie jest dla real-time control">
OpÃ³Åºnienie RTT (Round-Trip Time) do chmury publicznej: 50â€“200 ms (Europaâ€“AWS eu-west-1) + variability (jitter). To zbyt wolne dla safety-critical logic. Cloud sÅ‚uÅ¼y do **analityki, raportowania, dÅ‚ugoterminowego planowania**, nie do kontroli procesu.
</KeyConcept>

<Example title="Architektura cloud: Portfolio 50 MW (10 farm PV)">
**Infrastruktura**: AWS (eu-central-1)

**Komponenty**:
1. **Ingestion**: AWS IoT Core (MQTT broker, 10 poÅ‚Ä…czeÅ„â€”po jednym na farmÄ™)
2. **Storage**:
   - Surowe dane 15-min: AWS Timestream (7 dni retencji, auto-archiwizacja do S3)
   - Archiwum: S3 Standard-IA (5 lat), Parquet format
3. **Analytics**:
   - AWS Lambda: Serverless funkcje do KPI calculations (triggered co 15 min)
   - SageMaker: Trening modeli ML (produkcja prediction, anomaly detection)
4. **Dashboards**:
   - Grafana Cloud: Operacyjne dashboardy (live data)
   - QuickSight: Biznesowe raporty (monthly, quarterly) dla board
5. **Integracja**: REST API (API Gateway) dla CMMS (Maximo), ERP (SAP)

**Koszty** (miesiÄ™cznie):
- IoT Core: â‚¬50
- Timestream: â‚¬200
- S3: â‚¬30 (storage) + â‚¬20 (data transfer out)
- Lambda + SageMaker: â‚¬100
- Grafana Cloud: â‚¬150
- **Total**: **~â‚¬550/miesiÄ…c** dla 50 MW (= â‚¬11/MW/miesiÄ…câ€”bardzo kompetytywne)

**ROI**: Redukcja Availability spadkÃ³w o 0.5 pp (lepsze predykcje awarii) = +25 MWh/rok/farm Ã— 10 farm Ã— â‚¬50/MWh = **+â‚¬12 500/rok**. Cloud zwraca siÄ™ w < 6 miesiÄ™cy.
</Example>

<details>
<summary>ğŸ“ Notatki prowadzÄ…cego</summary>

**Czas**: 12 minut

**Przebieg**:
1. PrzeglÄ…d funkcji cloud (6 min)
2. Tabela decyzyjna (2 min)
3. PrzykÅ‚ad portfolio 50 MW (3 min)â€”pokaÅ¼ rzeczywiste dashboardy (screenshot Grafana Cloud) jeÅ›li masz
4. Dyskusja: "BezpieczeÅ„stwo danych w chmurzeâ€”czy to ryzyko?" (1 min)

**Punkty kluczowe**:
- **Cloud to nie obciÄ…Å¼enie, to oszczÄ™dnoÅ›Ä‡**: Przy dobrym projekcie (agregacja w fog, lifecycle policies), koszty cloud sÄ… niskie a wartoÅ›Ä‡ wysoka
- **ML w cloud to przyszÅ‚oÅ›Ä‡**: Edge AI dopiero startuje (W9), cloud ML jest dojrzaÅ‚y i dostÄ™pny dzisiaj
- **Vendor lock-in to realne ryzyko**: UÅ¼ywaj open standards (MQTT, InfluxDB line protocol, Parquet), nie proprietary AWS/Azure APIs

**Pytania studenckie**:
- Q: Co z prywatnoÅ›ciÄ…? Czy dane produkcji nie sÄ… wraÅ¼liwe?
- A: Dla farm prywatnych (< 10 MW): raczej nie. Dla duÅ¼ych portfolio (> 100 MW): takâ€”konkurencja moÅ¼e analizowaÄ‡ twoje wzorce. RozwiÄ…zanie: VPC, private cloud, lub anonymizacja danych (PII removal).

- Q: Czy chmura moÅ¼e "spaÅ›Ä‡"?
- A: Tak (AWS eu-west-1 outage 2020: 7 godzin). Dlatego: edge+fog **muszÄ… dziaÅ‚aÄ‡ bez cloud**. Cloud to "nice to have" dla analytics, nie "must have" dla kontroli.

</details>

---

## PrzepÅ‚yw danych: Widok caÅ‚oÅ›ciowy

PoniÅ¼szy diagram pokazuje **peÅ‚ny Å‚aÅ„cuch danych** od czujnikÃ³w do dashboardÃ³w, z zaznaczeniem protokoÅ‚Ã³w i czÄ™stotliwoÅ›ci.

```mermaid
flowchart TB
    subgraph Edge["ğŸ”¹ EDGE (on-site)"]
        S[Czujniki/Sterowniki<br/>Modbus RTU/TCP<br/>OPC UA]
        G[Gateway IoT<br/>Raspberry Pi<br/>Moxa UC-8100]
        S -->|1-10 Hz| G
    end

    subgraph Fog["ğŸ”¸ FOG (local server)"]
        SC[SCADA/Historian<br/>InfluxDB + Grafana<br/>Ignition SCADA]
        HMI[HMI lokalne<br/>Touchscreen<br/>Control Room]
        SC --> HMI
    end

    subgraph Cloud["â˜ï¸ CLOUD (data center)"]
        IOT[IoT Hub<br/>AWS IoT Core<br/>Azure IoT Hub]
        TSDB[Time-Series DB<br/>Timestream<br/>TimescaleDB]
        ML[Machine Learning<br/>SageMaker<br/>Azure ML]
        DASH[Dashboards<br/>Grafana Cloud<br/>Power BI]
        IOT --> TSDB
        TSDB --> ML
        TSDB --> DASH
    end

    G -->|MQTT/HTTPS<br/>15-min aggregates| SC
    SC -->|MQTT/REST<br/>15-min + events| IOT
    G -.lokalne alarmy<br/>SMS/email.-> O[ğŸ“± Operator]
    SC -.alarmy P1-P2.-> O
    DASH --> U[ğŸ‘¤ Stakeholders<br/>Inwestorzy, O&M, OSP]

    style Edge fill:#e1f5e1
    style Fog fill:#fff4e1
    style Cloud fill:#e1f0ff
```

### PrzepÅ‚yw typowy (normal operation)

1. **Czujniki â†’ Edge** (1-10 Hz, Modbus/OPC UA):
   - Surowe pomiary: napiÄ™cia, prÄ…dy, temperatury
   - Edge: filtracja, walidacja, normalizacja, buforowanie

2. **Edge â†’ Fog** (MQTT, co 1â€“15 min):
   - Zagregowane wartoÅ›ci (Å›rednie, min, max z okna czasowego)
   - Zdarzenia (alarmy, przeÅ‚Ä…czenia statusÃ³w)

3. **Fog â†’ Cloud** (MQTT/REST, co 15 min + event-driven):
   - Dane zagregowane (15-min aggregatesâ€”wystarczajÄ…ce dla long-term analytics)
   - KPI obliczone w fog (PR, Availability, CF)
   - Alarmy wysokiego priorytetu (P1, P2)

4. **Cloud â†’ Stakeholders** (dashboardy, raporty):
   - Real-time dashboards (opÃ³Åºnienie ~30 s, akceptowalne dla biznesu)
   - Raporty historyczne (monthly, yearly)
   - Prognozy ML (na 1â€“7 dni)

### PrzepÅ‚yw awaryjny (failure scenarios)

| Scenariusz | Zachowanie systemu |
|------------|--------------------|
| **Utrata Å‚Ä…cznoÅ›ci Edge â†’ Fog** | Edge buforuje dane (do 24 h), synchronizacja po przywrÃ³ceniu |
| **Utrata Å‚Ä…cznoÅ›ci Fog â†’ Cloud** | Fog przechowuje dane (do 30 dni), synchronizacja po przywrÃ³ceniu. Alarmy lokalne dziaÅ‚ajÄ… normalnie |
| **Awaria Fog** | Edge wysyÅ‚a dane bezpoÅ›rednio do Cloud (jeÅ›li ma Å‚Ä…cznoÅ›Ä‡). Lokalne HMI niedostÄ™pne, wymagana wizyta serwisu |
| **Awaria Cloud** | Edge i Fog dziaÅ‚ajÄ… normalnie (island mode). Brak dÅ‚ugoterminowej analityki i dashboardÃ³w biznesowych, ale proces kontrolowany |

<InteractiveQuiz
  question="Gdzie powinna dziaÅ‚aÄ‡ logika zatrzymania awaryjnego (emergency stop) w farmie PV przy detekcji Å‚uku elektrycznego (AFCI)?"
  options={[
    "Edge (lokalnie w combiner box lub inverterze)",
    "Fog (SCADA lokalny, po agregacji danych)",
    "Cloud (po analizie ML wszystkich farm w portfolio)",
    "MoÅ¼e dziaÅ‚aÄ‡ na dowolnym poziomie, zaleÅ¼y od preferencji"
  ]}
  correctAnswer={0}
  explanation="Emergency stop musi dziaÅ‚aÄ‡ lokalnie (edge), gdzie opÃ³Åºnienie < 10 ms. AFCI wykrywa Å‚uk elektryczny w milisekundach i natychmiast odcina string DC. Fog (opÃ³Åºnienie 100â€“500 ms) i cloud (opÃ³Åºnienie > 500 ms + ryzyko utraty Å‚Ä…cznoÅ›ci) sÄ… zbyt wolne dla safety-critical logic."
/>

<details>
<summary>ğŸ“ Notatki prowadzÄ…cego</summary>

**Czas**: 10 minut

**Przebieg**:
1. Prezentacja diagramu przepÅ‚ywu (5 min)â€”na rzutniku lub tablicy interaktywnej
2. OmÃ³wienie scenariuszy awaryjnych (3 min)â€”studenci czÄ™sto o tym nie myÅ›lÄ…, a to kluczowe dla niezawodnoÅ›ci
3. Quiz (2 min)

**Punkty kluczowe**:
- **Redundancja przepÅ‚ywu**: System musi dziaÅ‚aÄ‡ nawet przy awarii jednego poziomu (graceful degradation)
- **ProtokoÅ‚y**: MQTT dominuje jako transport (lightweight, pub-sub), OPC UA jako semantyka (structured tags)
- **Agregacja to klucz**: Bez agregacji w fog, cloud byÅ‚by zalany terabajtami surowych danych (nieopÅ‚acalne)

**Pytania studenckie**:
- Q: Dlaczego nie websockets zamiast MQTT?
- A: MoÅ¼na, ale MQTT ma (1) QoS (Quality of Serviceâ€”gwarantowane dostarczenie), (2) last will (automatyczna detekcja offline clients), (3) retained messages (nowy subscriber dostaje ostatniÄ… wartoÅ›Ä‡). WebSocket to tylko transport, MQTT to protokÃ³Å‚ aplikacyjny.

- Q: Co z cyberbezpieczeÅ„stwem? MQTT to plain text?
- A: MQTT sam w sobie nie szyfruje. UÅ¼ywa siÄ™ MQTT over TLS (mqtts://) + autentykacja certyfikatami (X.509). Plus: segregacja sieci (OT w VLAN osobnym od IT), firewall rules (tylko fog moÅ¼e initiate poÅ‚Ä…czenia do cloud, nie odwrotnie).

</details>

---

## Decyzje architektoniczne: Podsumowanie

Projektowanie architektury monitoringu OZE wymaga **zbalansowania** wielu czynnikÃ³w:

### 1. OpÃ³Åºnienia i niezawodnoÅ›Ä‡

**Zasada**: **Im bliÅ¼ej procesu, tym bardziej krytyczne** (safety).

- **Latency requirements**:
  - Emergency stop: < 10 ms â†’ **Edge**
  - Alarmy operacyjne: < 1 s â†’ **Edge/Fog**
  - Dashboardy operacyjne: < 10 s â†’ **Fog**
  - Raporty biznesowe: < 1 min â†’ **Cloud** (akceptowalne)

- **Resilience**:
  - Edge + Fog muszÄ… dziaÅ‚aÄ‡ **bez cloud** przez dniâ€“tygodnie (island mode)
  - Edge musi dziaÅ‚aÄ‡ **bez fog** przez godziny (local buffering)
  - **Single point of failure** (SPOF): redundancja dla fog w instalacjach > 10 MW

### 2. Retencja danych

**Koszt storage roÅ›nie liniowo z czasem i rozdzielczoÅ›ciÄ…**. Strategia:

| Warstwa | RozdzielczoÅ›Ä‡ | Retencja | PrzykÅ‚ad (farma 10 MW) |
|---------|---------------|----------|------------------------|
| Edge | 1â€“10 s | 1â€“48 h | 10 GB (RAM/flash) |
| Fog | 1â€“10 s | 7â€“30 dni | 500 GB (SSD/HDD) |
| Cloud | 15 min (aggregates) | 5â€“10 lat | 100 GB/rok (S3, compressed) |

**Lifecycle policy**: Po 1 roku w S3 Standard â†’ archiwizacja do S3 Glacier (â‚¬0.004/GB/miesiÄ…c), retrieval time 1â€“12 h (akceptowalne dla audytÃ³w).

### 3. Standaryzacja interfejsÃ³w

**Vendor lock-in to gÅ‚Ã³wne ryzyko** dÅ‚ugoterminowe. Preferuj **otwarte standardy**:

- **ProtokoÅ‚y**:
  - OPC UA (IEC 62541) dla structured data (tagi z typami, jednostkami, zakresami)
  - MQTT (ISO/IEC 20922) dla lightweight telemetry
  - Modbus (de facto standard, legacy ale wciÄ…Å¼ dominujÄ…cy w PV/wiatr)

- **Formaty danych**:
  - InfluxDB Line Protocol (prosty, human-readable: `measurement,tag1=value1 field1=123 timestamp`)
  - JSON (uniwersalny, ale verboseâ€”nie dla high-frequency data)
  - Parquet (columnar, compressedâ€”idealne dla cloud storage)

- **APIs**:
  - REST (dla cloud integrations)
  - GraphQL (dla flexible queries w dashboardach)

:::tip Praktyczna wskazÃ³wka
Przy wyborze komponentÃ³w, zadaj pytanie: **"Co siÄ™ stanie, gdy za 5 lat producent tego software przestanie istnieÄ‡?"** JeÅ›li odpowiedÅº to "musimy przepisaÄ‡ wszystko", wybierz rozwiÄ…zanie open-source lub z otwartymi API.
:::

### 4. Koszty i skalowalnoÅ›Ä‡

**CapEx vs. OpEx trade-off**:

- **MaÅ‚a instalacja** (< 1 MW): Cloud-first (niskie CapEx, wyÅ¼szy OpEx)
  - Edge: Smart inverters z wbudowanym MQTT
  - Fog: Opcjonalny (moÅ¼e byÄ‡ pominiÄ™ty, edge â†’ cloud bezpoÅ›rednio)
  - Cloud: SaaS (np. SolarEdge Monitoring, Fronius Solar.web)
  - **CapEx**: ~â‚¬1000, **OpEx**: ~â‚¬500/rok

- **Åšrednia instalacja** (1â€“10 MW): Hybrid (fog lokalny, cloud dla analytics)
  - Edge: Gateways IoT (Raspberry Pi, Moxa)
  - Fog: SCADA lokalny (Ignition, InfluxDB + Grafana)
  - Cloud: AWS/Azure dla ML i raportÃ³w
  - **CapEx**: ~â‚¬10â€“30k, **OpEx**: ~â‚¬2000/rok

- **DuÅ¼e portfolio** (> 100 MW): Private cloud (najniÅ¼szy OpEx long-term)
  - Edge: Gateways przemysÅ‚owe (Siemens, Moxa)
  - Fog: Redundant SCADA (active-standby)
  - Cloud: On-premise data center (Kubernetes cluster, self-hosted InfluxDB/Grafana)
  - **CapEx**: ~â‚¬500k (servers, network, redundancy), **OpEx**: ~â‚¬50k/rok (bez licencji commercial SCADA)

<details>
<summary>ğŸ“ Notatki prowadzÄ…cego</summary>

**Czas**: 8 minut

**Przebieg**:
1. PrzeglÄ…d 4 aspektÃ³w decyzji architektonicznych (po 2 min kaÅ¼dy)
2. Podsumowanie: "Nie ma one-size-fits-all, projektuj pod konkretne wymagania"

**Punkty kluczowe**:
- **Latency drives layering**: To gÅ‚Ã³wny powÃ³d, dla ktÃ³rego nie mamy wszystkiego w cloud
- **Retencja = koszty**: Studenci czÄ™sto nie rozumiejÄ…, Å¼e storage to ongoing expense (cloud bills kaÅ¼dego miesiÄ…ca)
- **Open standards = insurance**: Przeciw vendor lock-in

**Pytania studenckie**:
- Q: Czy blockchain moÅ¼e byÄ‡ uÅ¼yty w monitoringu OZE (dla niemodyfikowalnych rekordÃ³w produkcji)?
- A: Teoretycznie tak (np. Energy Web Chain dla green certificates). Praktycznie: (1) koszty (gas fees), (2) latency (finalizacja blokÃ³w 10â€“60 s), (3) brak industry adoption. Lepsze rozwiÄ…zanie: timestamping w trust ed third-party (np. OSP portal z digital signatures).

</details>

---

## Podsumowanie

**Architektura edge-fog-cloud** to **najlepsza praktyka** dla nowoczesnych systemÃ³w monitoringu OZE, poniewaÅ¼:

1. **Edge** zapewnia **szybkoÅ›Ä‡ reakcji** (safety) i **niezawodnoÅ›Ä‡** (buffering)
2. **Fog** dostarcza **kontekst lokalny** (agregacja, near-RT analytics) i **resilience** (island mode)
3. **Cloud** umoÅ¼liwia **dÅ‚ugoterminowÄ… analitykÄ™**, **ML/AI**, **benchmarking** i **integracjÄ™ biznesowÄ…**

**Kluczowe wnioski**:
- Safety-critical logic: **Edge/Fog only** (< 100 ms latency)
- Operational analytics: **Fog** (real-time HMI, KPI)
- Strategic analytics: **Cloud** (ML, fleet management, reporting)
- Resilience: **KaÅ¼da warstwa musi dziaÅ‚aÄ‡ niezaleÅ¼nie** (graceful degradation)

W nastÄ™pnej sekcji przejdziemy do szczegÃ³Å‚Ã³w **typÃ³w danych i ÅºrÃ³deÅ‚** w instalacjach OZEâ€”jakie parametry monitorujemy, z jakich urzÄ…dzeÅ„ i w jakich formatach.


